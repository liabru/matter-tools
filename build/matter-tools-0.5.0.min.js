/**
* matter-tools-0.5.0.min.js 0.5.0-alpha 2014-05-04
* https://github.com/liabru/matter-tools
* License: MIT
*/

function Resurrect(a){this.table=null,this.prefix="#",this.cleanup=!1,this.revive=!0;for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.refcode=this.prefix+"id",this.origcode=this.prefix+"original",this.buildcode=this.prefix+".",this.valuecode=this.prefix+"v"}!function(){var a={},b=Matter.Engine,c=Matter.World,d=Matter.Bodies,e=Matter.Body,f=Matter.Composite,g=(Matter.Composites,Matter.Common),h=(Matter.Constraint,Matter.Events),i=Matter.Bounds,j=Matter.Vector,k=Matter.Vertices,l=(Matter.MouseConstraint,Matter.Render),m=Matter.RenderPixi,n=Matter.Mouse,o=Matter.Query,p={};!function(){p.create=function(b,c){var d=window.dat&&window.localStorage;if(!d)return void console.log("Could not create GUI. Check dat.gui library is loaded first.");var e=new dat.GUI(c),f={engine:b,datGui:e,amount:1,size:40,sides:4,density:.001,restitution:0,friction:.1,frictionAir:.01,offset:{x:0,y:0},renderer:"canvas",chamfer:0};return Resurrect&&(f.serializer=new Resurrect({prefix:"$",cleanup:!0}),f.serializer.parse=f.serializer.resurrect),a(f),f},p.update=function(a,b){var c;b=b||a.datGui;for(c in b.__folders)p.update(a,b.__folders[c]);for(c in b.__controllers){var d=b.__controllers[c];d.updateDisplay&&d.updateDisplay()}},p.closeAll=function(a){var b=a.datGui;for(var c in b.__folders)b.__folders[c].close()},p.saveState=function(a,b,c){localStorage&&a&&localStorage.setItem(c,p.serialise(a,b.world))},p.loadState=function(a,c,d){var e;localStorage&&a&&(e=a.parse(localStorage.getItem(d))),e&&b.merge(c,{world:e})},p.serialise=function(a,b,c){return c=c||0,a.stringify(b,function(a,b){if(!/^#/.exec(a)&&"number"==typeof b){var c=parseFloat(b.toFixed(3));return 0===c&&0!==b?b:c}return b},c)},p.clone=function(a,b){var c=a.parse(p.serialise(a,b));return c.id=g.nextId(),c};var a=function(a){var b=a.engine,c=a.datGui,d={addBody:function(){i(a)},clear:function(){j(a)},save:function(){p.saveState(a.serializer,b,"guiState"),h.trigger(a,"save")},load:function(){p.loadState(a.serializer,b,"guiState"),h.trigger(a,"load")},inspect:function(){q.instance||(a.inspector=q.create(a.engine))}},g=c.addFolder("Metrics");g.add(b.timing,"fps").listen(),b.metrics.extended?(g.add(b.timing,"delta").listen(),g.add(b.timing,"correction").listen(),g.add(b.metrics,"bodies").listen(),g.add(b.metrics,"collisions").listen(),g.add(b.metrics,"pairs").listen(),g.add(b.metrics,"broadEff").listen(),g.add(b.metrics,"midEff").listen(),g.add(b.metrics,"narrowEff").listen(),g.add(b.metrics,"narrowReuse").listen(),g.close()):g.open();var k=c.addFolder("Add Body");k.add(a,"amount",1,5).step(1),k.add(a,"size",5,150).step(1),k.add(a,"sides",1,8).step(1),k.add(a,"density",1e-4,.01).step(.001),k.add(a,"friction",0,1).step(.05),k.add(a,"frictionAir",0,10*a.frictionAir).step(a.frictionAir/10),k.add(a,"restitution",0,1).step(.1),k.add(a,"chamfer",0,30).step(2),k.add(d,"addBody"),k.open();var l=c.addFolder("World");l.add(d,"inspect"),l.add(d,"load"),l.add(d,"save"),l.add(d,"clear"),l.open();var m=l.addFolder("Gravity");m.add(b.world.gravity,"x",-1,1).step(.01),m.add(b.world.gravity,"y",-1,1).step(.01),m.open();var n=c.addFolder("Engine");n.add(b,"enableSleeping"),n.add(b.broadphase,"current",["grid","bruteForce"]).onFinishChange(function(){f.setModified(b.world,!0,!1,!1)}),n.add(b.timing,"timeScale",0,1.2).step(.05).listen(),n.add(b,"velocityIterations",1,10).step(1),n.add(b,"positionIterations",1,10).step(1),n.add(b,"enabled"),n.open();var o=c.addFolder("Render");o.add(a,"renderer",["canvas","webgl"]).onFinishChange(function(b){e(a,b)}),o.add(b.render.options,"wireframes"),o.add(b.render.options,"showDebug"),o.add(b.render.options,"showPositions"),o.add(b.render.options,"showBroadphase"),o.add(b.render.options,"showBounds"),o.add(b.render.options,"showVelocity"),o.add(b.render.options,"showCollisions"),o.add(b.render.options,"showAxes"),o.add(b.render.options,"showAngleIndicator"),o.add(b.render.options,"showSleeping"),o.add(b.render.options,"showIds"),o.add(b.render.options,"showShadows"),o.add(b.render.options,"enabled"),o.open()},e=function(a,b){var c,d=a.engine;"canvas"===b&&(c=l),"webgl"===b&&(c=m),d.render.element.removeChild(d.render.canvas);var e=d.render.options;d.render=c.create({element:d.render.element,options:e}),d.render.options=e,n.setElement(d.input.mouse,d.render.canvas)},i=function(a){var b=a.engine,e={density:a.density,friction:a.friction,frictionAir:a.frictionAir,restitution:a.restitution};a.chamfer&&a.sides>2&&(e.chamfer={radius:a.chamfer});for(var f=0;f<a.amount;f++)c.add(b.world,d.polygon(a.offset.x+120+f*a.size+50*f,a.offset.y+200,a.sides,a.size,e))},j=function(a){var d=a.engine;c.clear(d.world,!0),b.clear(d);var e=d.render.controller;e.clear&&e.clear(d.render),h.trigger(a,"clear")}}();var q={};!function(){var a,b,c="WebkitAppearance"in document.documentElement.style;q.create=function(e,h){if(!jQuery||!$.fn.jstree||!window.key)return void console.log("Could not create inspector. Check keymaster, jQuery, jsTree libraries are loaded first.");var j={engine:e,isPaused:!1,selected:[],selectStart:null,selectEnd:null,selectBounds:i.create(),mousePrevPosition:{x:0,y:0},offset:{x:0,y:0},autoHide:!0,autoRewind:!0,hasTransitions:c?!0:!1,bodyClass:"",exportIndent:0,clipboard:[],controls:{container:null,worldTree:null},root:f.create({label:"Root"})};return j=g.extend(j,h),q.instance=j,j.serializer=new Resurrect({prefix:"$",cleanup:!0}),j.serializer.parse=j.serializer.resurrect,localStorage.removeItem("pauseState"),b=$("body"),b.toggleClass("ins-auto-hide gui-auto-hide",j.autoHide),b.toggleClass("ins-transitions gui-transitions",j.hasTransitions),f.add(j.root,e.world),e.world.isModified=!0,e.world.parent=null,a=window.key,d(j),u(j),n(j),m(j),j};var d=function(a){var c=(a.engine,a.controls),d=$('<div class="ins-container">'),e=$('<div class="ins-control-group">'),f=$('<input class="ins-search-box" type="search" placeholder="search">'),g=$('<button class="ins-import-button ins-button">Import</button>'),h=$('<button class="ins-export-button ins-button">Export</button>'),i=$('<button class="ins-pause-button ins-button">Pause</button>'),j=$('<button class="ins-help-button ins-button">Help</button>'),k=$('<button class="ins-add-button ins-button">+</button>');e.append(i,g,h,j),d.prepend(e,f,k),b.prepend(d),c.pauseButton=i,c.importButton=g,c.exportButton=h,c.helpButton=j,c.searchBox=f,c.container=d,c.addCompositeButton=k,c.pauseButton.click(function(){C(a,!a.isPaused)}),c.exportButton.click(function(){L(a)}),c.importButton.click(function(){M(a)}),c.helpButton.click(function(){l(a)}),c.addCompositeButton.click(function(){K(a)});var m;c.searchBox.keyup(function(){clearTimeout(m),m=setTimeout(function(){var a=c.searchBox.val(),b=c.worldTree.data("jstree");b.search(a)},250)})},l=function(){var a="Matter Tools\n\n";a+="Drag nodes in the tree to move them between composites.\n",a+="Use browser's developer console to inspect selected objects.\n",a+="Note: selections only render if renderer supports it.\n\n",a+="[shift + space] pause or play simulation.\n",a+="[right click] and drag on empty space to select a region.\n",a+="[right click] and drag on an object to move it.\n",a+="[right click + shift] and drag to move whole selection.\n\n",a+="[ctrl-c] to copy selected world objects.\n",a+="[ctrl-v] to paste copied world objects to mouse position.\n",a+="[del] or [backspace] delete selected objects.\n\n",a+="[shift + s] scale-xy selected objects with mouse or arrows.\n",a+="[shift + s + d] scale-x selected objects with mouse or arrows.\n",a+="[shift + s + f] scale-y selected objects with mouse or arrows.\n",a+="[shift + r] rotate selected objects with mouse or arrows.\n\n",a+="[shift + q] set selected objects as static (can't be undone).\n",a+="[shift + i] import objects.\n",a+="[shift + o] export selected objects.\n",a+="[shift + h] toggle Matter.Gui.\n",a+="[shift + y] toggle auto-hide.\n",a+="[shift + r] toggle auto-rewind on play/pause.\n\n",a+="[shift + j] show this help message.",alert(a)},m=function(c){c.engine,c.controls;a("shift+space",function(){C(c,!c.isPaused)}),a("shift+o",function(){L(c)}),a("shift+i",function(){M(c)}),a("shift+j",function(){l(c)}),a("shift+y",function(){c.autoHide=!c.autoHide,b.toggleClass("ins-auto-hide gui-auto-hide",c.autoHide)}),a("shift+r",function(){c.autoRewind=!c.autoRewind,c.autoRewind||localStorage.removeItem("pauseState")}),a("shift+q",function(){for(var a=(c.controls.worldTree.data("jstree"),0);a<c.selected.length;a++){var b=c.selected[a].data;"body"!==b.type||b.isStatic||e.setStatic(b,!0)}}),a("del",function(){v(c)}),a("backspace",function(){v(c)}),a("ctrl+c",function(){w(c)}),a("ctrl+v",function(){x(c)}),$(document).unbind("keydown").bind("keydown",function(a){var b=!1;if(8===a.keyCode){var c=a.srcElement||a.target;b="INPUT"===c.tagName.toUpperCase()&&("TEXT"===c.type.toUpperCase()||"PASSWORD"===c.type.toUpperCase()||"FILE"===c.type.toUpperCase()||"EMAIL"===c.type.toUpperCase()||"SEARCH"===c.type.toUpperCase())||"TEXTAREA"===c.tagName.toUpperCase()?c.readOnly||c.disabled:!0}b&&a.preventDefault()})},n=function(a){var b,c=a.engine,d=a.controls,e={core:{check_callback:!0},dnd:{copy:!1},search:{show_only_matches:!0,fuzzy:!1},types:{"#":{valid_children:[]},body:{valid_children:[]},constraint:{valid_children:[]},composite:{valid_children:[]},bodies:{valid_children:["body"]},constraints:{valid_children:["constraint"]},composites:{valid_children:["composite"]}},plugins:["dnd","types","unique","search"]};d.worldTree=$('<div class="ins-world-tree">').jstree(e),d.container.prepend(d.worldTree),d.worldTree.on("changed.jstree",function(e,g){var h=[],i=d.worldTree.data("jstree");"select_node"===g.action&&(clearTimeout(b),b=setTimeout(function(){g.selected=i.get_selected();for(var b=0;b<g.selected.length;b++){var d=g.selected[b],e=d.split("_")[0],j=d.split("_")[1],k=f.get(c.world,j,e);switch(e){case"body":case"constraint":case"composite":h.push(k)}}D(a,h)},1))}),$(document).on("dnd_stop.vakata",function(b,c){for(var e=d.worldTree.data("jstree"),g=c.data.nodes,h=0;h<g.length;h++){var i=e.get_node(g[h]),j=e.get_node(e.get_parent(g[h])),k=i.data.compositeId,l=j.data.compositeId;if(k!==l){var m=g[h],n=m.split("_")[0],o=m.split("_")[1],p=f.get(a.root,o,n),q=f.get(a.root,k,"composite"),r=f.get(a.root,l,"composite");f.move(q,p,r)}}}),d.worldTree.on("dblclick.jstree",function(){for(var a=d.worldTree.data("jstree"),b=a.get_selected(),e=0;e<b.length;e++){{var g=b[e],h=g.split("_")[0],i=g.split("_")[1];f.get(c.world,i,h)}switch(h){case"composite":case"composites":case"bodies":case"constraints":for(var j=(a.get_node(g),a.get_node(g).children),k=0;k<j.length;k++)a.select_node(j[k],!1)}}})},r=function(a,c){-1===a.bodyClass.indexOf(" "+c)&&(b.addClass(c),a.bodyClass=" "+b.attr("class"))},s=function(a,c){for(var d=!1,e=c.split(" "),f=0;f<e.length&&!(d=-1!==a.bodyClass.indexOf(" "+e[f]));f++);d&&(b.removeClass(c),a.bodyClass=" "+b.attr("class"))},t=function(a){return j.add(a.engine.input.mouse.position,a.offset)},u=function(b){var c=b.engine,d=c.input.mouse,e=t(b),l=b.controls;h.on(c,"tick",function(){e=t(b);var f=e.x-b.mousePrevPosition.x,h=a.isPressed("up")+a.isPressed("right")-a.isPressed("down")-a.isPressed("left"),j=f+h;if(c.world.isModified){var k=G(b.root,null,!0);F(l.worldTree.data("jstree"),k),D(b,[])}if(null!==b.selectStart&&(b.selectEnd.x=e.x,b.selectEnd.y=e.y,i.update(b.selectBounds,[b.selectStart,b.selectEnd])),a.shift&&a.isPressed("r")){var m=.03,n=Math.max(-2,Math.min(2,j))*m;r(b,"ins-cursor-rotate"),B(b,n)}else s(b,"ins-cursor-rotate");if(a.shift&&a.isPressed("s")){var o=.02,p=1+Math.max(-2,Math.min(2,j))*o;r(b,"ins-cursor-scale"),a.isPressed("d")?(scaleX=p,scaleY=1):a.isPressed("f")?(scaleX=1,scaleY=p):scaleX=scaleY=p,A(b,scaleX,scaleY)}else s(b,"ins-cursor-scale");2!==d.button||d.sourceEvents.mousedown||d.sourceEvents.mouseup?s(b,"ins-cursor-move"):(r(b,"ins-cursor-move"),z(b,e.x,e.y)),b.mousePrevPosition=g.clone(e)}),h.on(c,"mouseup",function(){if(null!==b.selectStart){var a=o.region(f.allBodies(c.world),b.selectBounds);D(b,a)}b.selectStart=null,b.selectEnd=null,h.trigger(b,"selectEnd")}),h.on(c,"mousedown",function(c){var l,m=c.source,n=f.allBodies(m.world),o=f.allConstraints(m.world),p=a.shift||a.control,q=b.controls.worldTree.data("jstree");if(2===d.button){var s=!1;for(l=0;l<n.length;l++){var t=n[l];if(i.contains(t.bounds,e)&&k.contains(t.vertices,e)){p?E(b,t):D(b,[t]),s=!0;break}}if(!s){for(l=0;l<o.length;l++){var u=o[l],v=u.bodyA,w=u.bodyB;if(-1===u.label.indexOf("Mouse Constraint")){var x=u.pointA,z=u.pointB;if(v&&(x=j.add(v.position,u.pointA)),w&&(z=j.add(w.position,u.pointB)),x&&z){var A=j.magnitudeSquared(j.sub(e,x)),B=j.magnitudeSquared(j.sub(e,z));if(100>A||100>B){p?E(b,u):D(b,[u]),s=!0;break}}}}s?(b.selectStart=null,b.selectEnd=null):(q.deselect_all(!0),D(b,[]),b.selectStart=g.clone(e),b.selectEnd=g.clone(e),i.update(b.selectBounds,[b.selectStart,b.selectEnd]),h.trigger(b,"selectStart"))}}2===d.button&&b.selected.length>0&&(r(b,"ins-cursor-move"),y(b))}),h.on(c,"afterRender",function(){var a=c.render.controller,d=c.render.context;a.inspector&&a.inspector(b,d)})},v=function(a){var b,c,d=[],e=a.controls.worldTree.data("jstree");for(c=0;c<a.selected.length;c++)b=a.selected[c].data,b!==a.engine.world&&d.push(b);var g=e.get_selected();for(c=0;c<g.length;c++){var h=e.get_node(g[c]);if("composite"===h.type&&(h=e.get_node(h.children[0]),h.data)){var i=h.data.compositeId;b=f.get(a.root,i,"composite"),b&&b!==a.engine.world&&(d.push(b),e.delete_node(g[c]))}}f.remove(a.root,d,!0),D(a,[])},w=function(a){a.clipboard.length=0;for(var b=0;b<a.selected.length;b++){var c=a.selected[b].data;"body"===c.type&&a.clipboard.push(c)}},x=function(a){for(var b=[],c=a.controls.worldTree.data("jstree"),d=0;d<a.clipboard.length;d++){var g=a.clipboard[d],h=p.clone(a.serializer,g);e.translate(h,{x:50,y:50});var i=c.get_node(g.type+"_"+g.id,!1),j=i.data.compositeId,k=f.get(a.engine.world,j,"composite");f.add(k,h),b.push(h)}setTimeout(function(){D(a,b)},200)},y=function(a){for(var b,c,d=a.selected,e=(a.engine.input.mouse,t(a)),f=0;f<d.length;f++)b=d[f],c=b.data,c.position?b.mousedownOffset={x:e.x-c.position.x,y:e.y-c.position.y}:c.pointA&&!c.bodyA?b.mousedownOffset={x:e.x-c.pointA.x,y:e.y-c.pointA.y}:c.pointB&&!c.bodyB&&(b.mousedownOffset={x:e.x-c.pointB.x,y:e.y-c.pointB.y})},z=function(a,b,c){for(var d,f,g=a.selected,h=(a.engine.input.mouse,t(a),0);h<g.length;h++)if(d=g[h],f=d.data,d.mousedownOffset)switch(f.type){case"body":var i={x:b-f.position.x-d.mousedownOffset.x,y:c-f.position.y-d.mousedownOffset.y};e.translate(f,i),f.positionPrev.x=f.position.x,f.positionPrev.y=f.position.y;break;case"constraint":var k=f.pointA;f.bodyA&&(k=f.pointB),k.x=b-d.mousedownOffset.x,k.y=c-d.mousedownOffset.y;var l=f.bodyA?j.add(f.bodyA.position,f.pointA):f.pointA,m=f.bodyB?j.add(f.bodyB.position,f.pointB):f.pointB;f.length=j.magnitude(j.sub(l,m))}},A=function(a,b,c){for(var d,f,g=a.selected,h=0;h<g.length;h++)switch(d=g[h],f=d.data,f.type){case"body":e.scale(f,b,c,f.position),f.circleRadius&&(f.circleRadius*=b)}},B=function(a,b){for(var c,d,f=a.selected,g=0;g<f.length;g++)switch(c=f[g],d=c.data,d.type){case"body":e.rotate(d,b)}},C=function(a,b){b?(a.autoRewind&&(D(a,[]),p.loadState(a.serializer,a.engine,"pauseState")),a.engine.timing.timeScale=0,a.isPaused=!0,a.controls.pauseButton.text("Play"),h.trigger(a,"paused")):(a.autoRewind&&p.saveState(a.serializer,a.engine,"pauseState"),a.engine.timing.timeScale=1,a.isPaused=!1,a.controls.pauseButton.text("Pause"),h.trigger(a,"play"))},D=function(a,b){var c,d,e=a.controls.worldTree.data("jstree");for(d=0;d<a.selected.length;d++)c=a.selected[d].data,e.deselect_node(c.type+"_"+c.id,!0);for(a.selected=[],console.clear(),d=0;d<b.length;d++)c=b[d],c&&(E(a,c),5>d?console.log(c.label+" "+c.id+": %O",c):6===d&&console.warn("Omitted inspecting "+(b.length-5)+" more objects"))},E=function(a,b){if(b){var c=a.controls.worldTree.data("jstree");a.selected.push({data:b}),c.select_node(b.type+"_"+b.id,!0)}},F=function(a,b){b[0].state=b[0].state||{opened:!0},a.settings.core.data=b,a.refresh(-1)},G=function(a,b,c){var d=[],e={id:"composite_"+a.id,data:{compositeId:b},type:"composite",text:(a.label?a.label:"Composite")+" "+a.id,li_attr:{"class":"jstree-node-type-composite"}},f=H(a.composites,a.id);return f.id="composites_"+a.id,d.push(f),c?f.children:(f=I(a.bodies,a.id),f.id="bodies_"+a.id,d.push(f),f=J(a.constraints,a.id),f.id="constraints_"+a.id,d.push(f),e.children=d,e)},H=function(a,b){for(var c={type:"composites",text:"Composites",data:{compositeId:b},children:[],li_attr:{"class":"jstree-node-type-composites"}},d=0;d<a.length;d++){var e=a[d];c.children.push(G(e,b))}return c},I=function(a,b){for(var c={type:"bodies",text:"Bodies",data:{compositeId:b},children:[],li_attr:{"class":"jstree-node-type-bodies"}},d=0;d<a.length;d++){var e=a[d];c.children.push({type:"body",id:"body_"+e.id,data:{compositeId:b},text:(e.label?e.label:"Body")+" "+e.id,li_attr:{"class":"jstree-node-type-body"}})}return c},J=function(a,b){for(var c={type:"constraints",text:"Constraints",data:{compositeId:b},children:[],li_attr:{"class":"jstree-node-type-constraints"}},d=0;d<a.length;d++){var e=a[d];c.children.push({type:"constraint",id:"constraint_"+e.id,data:{compositeId:b},text:(e.label?e.label:"Constraint")+" "+e.id,li_attr:{"class":"jstree-node-type-constraint"}})}return c},K=function(a){var b=f.create();f.add(a.root,b),a.root.composites.splice(a.root.composites.length-1,1),a.root.composites.unshift(b),f.setModified(a.engine.world,!0,!0,!1)},L=function(a){a.engine;if(0===a.selected.length)return void alert("No objects were selected, so export could not be created. Can only export objects that are in the World composite.");for(var b="export-objects",d=f.create({label:"Exported Objects"}),e=0;e<a.selected.length;e++){var g=a.selected[e].data;f.get(d,g.id,g.type)||(f.add(d,g),1===a.selected.length&&(b="export-"+g.label+"-"+g.id))}b=b.toLowerCase().replace(/[^\w\-]/g,"")+".json";var i=p.serialise(a.serializer,d,a.exportIndent);if(c){var j=new Blob([i],{type:"application/json"}),k=document.createElement("a");k.download=b,k.href=(window.webkitURL||window.URL).createObjectURL(j),k.dataset.downloadurl=["application/json",k.download,k.href].join(":"),k.click()}else window.open("data:application/json;charset=utf-8,"+escape(i));h.trigger(a,"export")},M=function(a){var b,c=(a.engine,document.createElement("div"));c.innerHTML='<input type="file">',b=c.firstChild,b.addEventListener("change",function(){var c=b.files[0];if(c.name.match(/\.(txt|json)$/)){var d=new FileReader;d.onload=function(){var b=a.serializer.parse(d.result);if(b){b.label="Imported Objects",f.rebase(b),f.add(a.root,b),a.root.composites.splice(a.root.composites.length-1,1),a.root.composites.unshift(b);var c=a.controls.worldTree.data("jstree"),e=G(a.root,null,!0);F(c,e)}},d.readAsText(c)}else alert("File not supported, .json or .txt JSON files only")}),b.click()}}(),a.Gui=p,a.Inspector=q,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.MatterTools=a),"function"==typeof define&&define.amd&&define("MatterTools",[],function(){return a}),"object"==typeof window&&"object"==typeof window.document&&(window.MatterTools=a)}();var dat=dat||{};dat.gui=dat.gui||{},dat.utils=dat.utils||{},dat.controllers=dat.controllers||{},dat.dom=dat.dom||{},dat.color=dat.color||{},dat.utils.css=function(){return{load:function(a,b){b=b||document;var c=b.createElement("link");c.type="text/css",c.rel="stylesheet",c.href=a,b.getElementsByTagName("head")[0].appendChild(c)},inject:function(a,b){b=b||document;var c=document.createElement("style");c.type="text/css",c.innerHTML=a,b.getElementsByTagName("head")[0].appendChild(c)}}}(),dat.utils.common=function(){var a=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){return this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(b[c])||(a[c]=b[c])},this),a},defaults:function(a){return this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(a[c])&&(a[c]=b[c])},this),a},compose:function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),d=a.length-1;d>=0;d--)c=[a[d].apply(this,c)];return c[0]}},each:function(b,c,d){if(b)if(a&&b.forEach&&b.forEach===a)b.forEach(c,d);else if(b.length===b.length+0){for(var e=0,f=b.length;f>e;e++)if(e in b&&c.call(d,b[e],e)===this.BREAK)return}else for(var e in b)if(c.call(d,b[e],e)===this.BREAK)return},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return a===!1||a===!0},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}(),dat.controllers.Controller=function(a){var b=function(a,b){this.initialValue=a[b],this.domElement=document.createElement("div"),this.object=a,this.property=b,this.__onChange=void 0,this.__onFinishChange=void 0};return a.extend(b.prototype,{onChange:function(a){return this.__onChange=a,this},onFinishChange:function(a){return this.__onFinishChange=a,this},setValue:function(a){return this.object[this.property]=a,this.__onChange&&this.__onChange.call(this,a),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),b}(dat.utils.common),dat.dom.dom=function(a){function b(b){if("0"===b||a.isUndefined(b))return 0;var c=b.match(e);return a.isNull(c)?0:parseFloat(c[1])}var c={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},d={};a.each(c,function(b,c){a.each(b,function(a){d[a]=c})});var e=/(\d+(\.\d+)?)px/,f={makeSelectable:function(a,b){void 0!==a&&void 0!==a.style&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(b,c,d){a.isUndefined(c)&&(c=!0),a.isUndefined(d)&&(d=!0),b.style.position="absolute",c&&(b.style.left=0,b.style.right=0),d&&(b.style.top=0,b.style.bottom=0)},fakeEvent:function(b,c,e,f){e=e||{};var g=d[c];if(!g)throw new Error("Event type "+c+" not supported.");var h=document.createEvent(g);switch(g){case"MouseEvents":var i=e.x||e.clientX||0,j=e.y||e.clientY||0;h.initMouseEvent(c,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,i,j,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var k=h.initKeyboardEvent||h.initKeyEvent;a.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),k(c,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:h.initEvent(c,e.bubbles||!1,e.cancelable||!0)}a.defaults(h,f),b.dispatchEvent(h)},bind:function(a,b,c,d){return d=d||!1,a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c),f},unbind:function(a,b,c,d){return d=d||!1,a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c),f},addClass:function(a,b){if(void 0===a.className)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return f},removeClass:function(a,b){if(b)if(void 0===a.className);else if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),d=c.indexOf(b);-1!=d&&(c.splice(d,1),a.className=c.join(" "))}else a.className=void 0;return f},hasClass:function(a,b){return new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(a.className)||!1},getWidth:function(a){var c=getComputedStyle(a);return b(c["border-left-width"])+b(c["border-right-width"])+b(c["padding-left"])+b(c["padding-right"])+b(c.width)},getHeight:function(a){var c=getComputedStyle(a);return b(c["border-top-width"])+b(c["border-bottom-width"])+b(c["padding-top"])+b(c["padding-bottom"])+b(c.height)},getOffset:function(a){var b={left:0,top:0};if(a.offsetParent)do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent);return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return f}(dat.utils.common),dat.controllers.OptionController=function(a,b,c){var d=function(a,e,f){d.superclass.call(this,a,e);var g=this;if(this.__select=document.createElement("select"),c.isArray(f)){var h={};c.each(f,function(a){h[a]=a}),f=h}c.each(f,function(a,b){var c=document.createElement("option");c.innerHTML=b,c.setAttribute("value",a),g.__select.appendChild(c)}),this.updateDisplay(),b.bind(this.__select,"change",function(){var a=this.options[this.selectedIndex].value;g.setValue(a)}),this.domElement.appendChild(this.__select)};return d.superclass=a,c.extend(d.prototype,a.prototype,{setValue:function(a){var b=d.superclass.prototype.setValue.call(this,a);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),b},updateDisplay:function(){return this.__select.value=this.getValue(),d.superclass.prototype.updateDisplay.call(this)}}),d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.NumberController=function(a,b){function c(a){return a=a.toString(),a.indexOf(".")>-1?a.length-a.indexOf(".")-1:0}var d=function(a,e,f){d.superclass.call(this,a,e),f=f||{},this.__min=f.min,this.__max=f.max,this.__step=f.step,this.__impliedStep=b.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,this.__precision=c(this.__impliedStep)};return d.superclass=a,b.extend(d.prototype,a.prototype,{setValue:function(a){return void 0!==this.__min&&a<this.__min?a=this.__min:void 0!==this.__max&&a>this.__max&&(a=this.__max),void 0!==this.__step&&a%this.__step!=0&&(a=Math.round(a/this.__step)*this.__step),d.superclass.prototype.setValue.call(this,a)},min:function(a){return this.__min=a,this},max:function(a){return this.__max=a,this},step:function(a){return this.__step=a,this.__impliedStep=a,this.__precision=c(a),this}}),d}(dat.controllers.Controller,dat.utils.common),dat.controllers.NumberControllerBox=function(a,b,c){function d(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}var e=function(a,d,f){function g(){var a=parseFloat(m.__input.value);c.isNaN(a)||m.setValue(a)}function h(){g(),m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}function i(a){b.bind(window,"mousemove",j),b.bind(window,"mouseup",k),l=a.clientY}function j(a){var b=l-a.clientY;m.setValue(m.getValue()+b*m.__impliedStep),l=a.clientY}function k(){b.unbind(window,"mousemove",j),b.unbind(window,"mouseup",k)}this.__truncationSuspended=!1,e.superclass.call(this,a,d,f);var l,m=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),b.bind(this.__input,"change",g),b.bind(this.__input,"blur",h),b.bind(this.__input,"mousedown",i),b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(m.__truncationSuspended=!0,this.blur(),m.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return e.superclass=a,c.extend(e.prototype,a.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():d(this.getValue(),this.__precision),e.superclass.prototype.updateDisplay.call(this)}}),e}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common),dat.controllers.NumberControllerSlider=function(a,b,c,d,e){function f(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))}var g=function(a,c,d,e,h){function i(a){b.bind(window,"mousemove",j),b.bind(window,"mouseup",k),j(a)}function j(a){a.preventDefault();var c=b.getOffset(l.__background),d=b.getWidth(l.__background);return l.setValue(f(a.clientX,c.left,c.left+d,l.__min,l.__max)),!1}function k(){b.unbind(window,"mousemove",j),b.unbind(window,"mouseup",k),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}g.superclass.call(this,a,c,{min:d,max:e,step:h});var l=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),b.bind(this.__background,"mousedown",i),b.addClass(this.__background,"slider"),b.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return g.superclass=a,g.useDefaultStyles=function(){c.inject(e)},d.extend(g.prototype,a.prototype,{updateDisplay:function(){var a=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*a+"%",g.superclass.prototype.updateDisplay.call(this)}}),g}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,"/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n.slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),dat.controllers.FunctionController=function(a,b,c){var d=function(a,c,e){d.superclass.call(this,a,c);var f=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===e?"Fire":e,b.bind(this.__button,"click",function(a){return a.preventDefault(),f.fire(),!1}),b.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return d.superclass=a,c.extend(d.prototype,a.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.BooleanController=function(a,b,c){var d=function(a,c){function e(){f.setValue(!f.__prev)}d.superclass.call(this,a,c);var f=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),b.bind(this.__checkbox,"change",e,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return d.superclass=a,c.extend(d.prototype,a.prototype,{setValue:function(a){var b=d.superclass.prototype.setValue.call(this,a);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),b},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,d.superclass.prototype.updateDisplay.call(this)}}),d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.color.toString=function(a){return function(b){if(1==b.a||a.isUndefined(b.a)){for(var c=b.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common),dat.color.interpret=function(a,b){var c,d,e=function(){d=!1;var a=arguments.length>1?b.toArray(arguments):arguments[0];return b.each(f,function(e){return e.litmus(a)?(b.each(e.conversions,function(e,f){return c=e.read(a),d===!1&&c!==!1?(d=c,c.conversionName=f,c.conversion=e,b.BREAK):void 0}),b.BREAK):void 0}),d},f=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){var b=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);
return null===b?!1:{space:"HEX",hex:parseInt("0x"+b[1].toString()+b[1].toString()+b[2].toString()+b[2].toString()+b[3].toString()+b[3].toString())}},write:a},SIX_CHAR_HEX:{read:function(a){var b=a.match(/^#([A-F0-9]{6})$/i);return null===b?!1:{space:"HEX",hex:parseInt("0x"+b[1].toString())}},write:a},CSS_RGB:{read:function(a){var b=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===b?!1:{space:"RGB",r:parseFloat(b[1]),g:parseFloat(b[2]),b:parseFloat(b[3])}},write:a},CSS_RGBA:{read:function(a){var b=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===b?!1:{space:"RGB",r:parseFloat(b[1]),g:parseFloat(b[2]),b:parseFloat(b[3]),a:parseFloat(b[4])}},write:a}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return e}(dat.color.toString,dat.utils.common),dat.GUI=dat.gui.GUI=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b,c,f){if(void 0===b[c])throw new Error("Object "+b+' has no property "'+c+'"');var g;if(f.color)g=new k(b,c);else{var h=[b,c].concat(f.factoryArgs);g=d.apply(a,h)}f.before instanceof e&&(f.before=f.before.__li),s(a,g),n.addClass(g.domElement,"c");var i=document.createElement("span");n.addClass(i,"property-name"),i.innerHTML=g.property;var j=document.createElement("div");j.appendChild(i),j.appendChild(g.domElement);var l=q(a,j,f.before);return n.addClass(l,M.CLASS_CONTROLLER_ROW),n.addClass(l,typeof g.getValue()),r(a,l,g),a.__controllers.push(g),g}function q(a,b,c){var d=document.createElement("li");return b&&d.appendChild(b),c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d),a.onResize(),d}function r(a,b,c){if(c.__li=b,c.__gui=a,o.extend(c,{options:function(b){return arguments.length>1?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[o.toArray(arguments)]})):o.isArray(b)||o.isObject(b)?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[b]})):void 0},name:function(a){return c.__li.firstElementChild.firstElementChild.innerHTML=a,c},listen:function(){return c.__gui.listen(c),c},remove:function(){return c.__gui.remove(c),c}}),c instanceof i){var d=new h(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});o.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);return b.apply(c,a),e.apply(d,a)}}),n.addClass(b,"has-slider"),c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof h){var e=function(b){return o.isNumber(c.__min)&&o.isNumber(c.__max)?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=o.compose(e,c.min),c.max=o.compose(e,c.max)}else c instanceof f?(n.bind(b,"click",function(){n.fakeEvent(c.__checkbox,"click")}),n.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):c instanceof g?(n.bind(b,"click",function(){n.fakeEvent(c.__button,"click")}),n.bind(b,"mouseover",function(){n.addClass(c.__button,"hover")}),n.bind(b,"mouseout",function(){n.removeClass(c.__button,"hover")})):c instanceof k&&(n.addClass(b,"color"),c.updateDisplay=o.compose(function(a){return b.style.borderLeftColor=c.__color.toString(),a},c.updateDisplay),c.updateDisplay());c.setValue=o.compose(function(b){return a.getRoot().__preset_select&&c.isModified()&&A(a.getRoot(),!0),b},c.setValue)}function s(a,b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];if(void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e),e[b.property]=b,c.load&&c.load.remembered){var f,g=c.load.remembered;if(g[a.preset])f=g[a.preset];else{if(!g[H])return;f=g[H]}if(f[d]&&void 0!==f[d][b.property]){var h=f[d][b.property];b.initialValue=h,b.setValue(h)}}}}function t(a,b){return document.location.href+"."+b}function u(a){function b(){j.style.display=a.useLocalStorage?"block":"none"}var c=a.__save_row=document.createElement("li");n.addClass(a.domElement,"has-save"),a.__ul.insertBefore(c,a.__ul.firstChild),n.addClass(c,"save-row");var d=document.createElement("span");d.innerHTML="&nbsp;",n.addClass(d,"button gears");var e=document.createElement("span");e.innerHTML="Save",n.addClass(e,"button"),n.addClass(e,"save");var f=document.createElement("span");f.innerHTML="New",n.addClass(f,"button"),n.addClass(f,"save-as");var g=document.createElement("span");g.innerHTML="Revert",n.addClass(g,"button"),n.addClass(g,"revert");var h=a.__preset_select=document.createElement("select");if(a.load&&a.load.remembered?o.each(a.load.remembered,function(b,c){y(a,c,c==a.preset)}):y(a,H,!1),n.bind(h,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value}),c.appendChild(h),c.appendChild(d),c.appendChild(e),c.appendChild(f),c.appendChild(g),I){var i=document.getElementById("dg-save-locally"),j=document.getElementById("dg-local-explain");i.style.display="block";var k=document.getElementById("dg-local-storage");"true"===localStorage.getItem(t(a,"isLocal"))&&k.setAttribute("checked","checked"),b(),n.bind(k,"change",function(){a.useLocalStorage=!a.useLocalStorage,b()})}var l=document.getElementById("dg-new-constructor");n.bind(l,"keydown",function(a){!a.metaKey||67!==a.which&&67!=a.keyCode||C.hide()}),n.bind(d,"click",function(){l.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2),C.show(),l.focus(),l.select()}),n.bind(e,"click",function(){a.save()}),n.bind(f,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)}),n.bind(g,"click",function(){a.revert()})}function v(a){function b(b){return b.preventDefault(),e=b.clientX,n.addClass(a.__closeButton,M.CLASS_DRAG),n.bind(window,"mousemove",c),n.bind(window,"mouseup",d),!1}function c(b){return b.preventDefault(),a.width+=e-b.clientX,a.onResize(),e=b.clientX,!1}function d(){n.removeClass(a.__closeButton,M.CLASS_DRAG),n.unbind(window,"mousemove",c),n.unbind(window,"mouseup",d)}a.__resize_handle=document.createElement("div"),o.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;n.bind(a.__resize_handle,"mousedown",b),n.bind(a.__closeButton,"mousedown",b),a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function w(a,b){a.domElement.style.width=b+"px",a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px"),a.__closeButton&&(a.__closeButton.style.width=b+"px")}function x(a,b){var c={};return o.each(a.__rememberedObjects,function(d,e){var f={},g=a.__rememberedObjectIndecesToControllers[e];o.each(g,function(a,c){f[c]=b?a.initialValue:a.getValue()}),c[e]=f}),c}function y(a,b,c){var d=document.createElement("option");d.innerHTML=b,d.value=b,a.__preset_select.appendChild(d),c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function z(a){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].value==a.preset&&(a.__preset_select.selectedIndex=b)}function A(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function B(a){0!=a.length&&l(function(){B(a)}),o.each(a,function(a){a.updateDisplay()})}a.inject(c);var C,D,E="dg",F=72,G=20,H="Default",I=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}(),J=!0,K=!1,L=[],M=function(a){function b(){var a=c.getRoot();a.width+=1,o.defer(function(){a.width-=1})}var c=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),n.addClass(this.domElement,E),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=a||{},a=o.defaults(a,{autoPlace:!0,width:M.DEFAULT_WIDTH}),a=o.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),o.isUndefined(a.load)?a.load={preset:H}:a.preset&&(a.load.preset=a.preset),o.isUndefined(a.parent)&&a.hideable&&L.push(this),a.resizable=o.isUndefined(a.parent)&&a.resizable,a.autoPlace&&o.isUndefined(a.scrollable)&&(a.scrollable=!0);var d,e=I&&"true"===localStorage.getItem(t(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return c.parent?c.getRoot().preset:a.load.preset},set:function(b){c.parent?c.getRoot().preset=b:a.load.preset=b,z(this),c.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b,w(c,b)}},name:{get:function(){return a.name},set:function(b){a.name=b,g&&(g.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b,a.closed?n.addClass(c.__ul,M.CLASS_CLOSED):n.removeClass(c.__ul,M.CLASS_CLOSED),this.onResize(),c.__closeButton&&(c.__closeButton.innerHTML=b?M.TEXT_OPEN:M.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){I&&(e=a,a?n.bind(window,"unload",d):n.unbind(window,"unload",d),localStorage.setItem(t(c,"isLocal"),a))}}}),o.isUndefined(a.parent)){if(a.closed=!1,n.addClass(this.domElement,M.CLASS_MAIN),n.makeSelectable(this.domElement,!1),I&&e){c.useLocalStorage=!0;var f=localStorage.getItem(t(this,"gui"));f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=M.TEXT_CLOSED,n.addClass(this.__closeButton,M.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),n.bind(this.__closeButton,"click",function(){c.closed=!c.closed})}else{void 0===a.closed&&(a.closed=!0);var g=document.createTextNode(a.name);n.addClass(g,"controller-name");var h=q(c,g),i=function(a){return a.preventDefault(),c.closed=!c.closed,!1};n.addClass(this.__ul,M.CLASS_CLOSED),n.addClass(h,"title"),n.bind(h,"click",i),a.closed||(this.closed=!1)}a.autoPlace&&(o.isUndefined(a.parent)&&(J&&(D=document.createElement("div"),n.addClass(D,E),n.addClass(D,M.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(D),J=!1),D.appendChild(this.domElement),n.addClass(this.domElement,M.CLASS_AUTO_PLACE)),this.parent||w(c,a.width)),n.bind(window,"resize",function(){c.onResize()}),n.bind(this.__ul,"webkitTransitionEnd",function(){c.onResize()}),n.bind(this.__ul,"transitionend",function(){c.onResize()}),n.bind(this.__ul,"oTransitionEnd",function(){c.onResize()}),this.onResize(),a.resizable&&v(this),d=function(){I&&"true"===localStorage.getItem(t(c,"isLocal"))&&localStorage.setItem(t(c,"gui"),JSON.stringify(c.getSaveObject()))},this.saveToLocalStorageIfPossible=d;c.getRoot();a.parent||b()};return M.toggleHide=function(){K=!K,o.each(L,function(a){a.domElement.style.zIndex=K?-999:999,a.domElement.style.opacity=K?0:1})},M.CLASS_AUTO_PLACE="a",M.CLASS_AUTO_PLACE_CONTAINER="ac",M.CLASS_MAIN="main",M.CLASS_CONTROLLER_ROW="cr",M.CLASS_TOO_TALL="taller-than-window",M.CLASS_CLOSED="closed",M.CLASS_CLOSE_BUTTON="close-button",M.CLASS_DRAG="drag",M.DEFAULT_WIDTH=245,M.TEXT_CLOSED="Close Controls",M.TEXT_OPEN="Open Controls",n.bind(window,"keydown",function(a){"text"===document.activeElement.type||a.which!==F&&a.keyCode!=F||M.toggleHide()},!1),o.extend(M.prototype,{add:function(a,b){return p(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(a,b){return p(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li),this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;o.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&D.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw new Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[a]&&(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);var c=new M(b);this.__folders[a]=c;var d=q(this,c.domElement);return n.addClass(d,"folder"),c},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=n.getOffset(a.__ul).top,c=0;o.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=n.getHeight(b))}),window.innerHeight-b-G<c?(n.addClass(a.domElement,M.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-b-G+"px"):(n.removeClass(a.domElement,M.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&o.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"}),a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){if(o.isUndefined(C)&&(C=new m,C.domElement.innerHTML=b),this.parent)throw new Error("You can only call remember on a top level GUI.");var a=this;o.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&u(a),-1==a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)}),this.autoPlace&&w(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;return a.closed=this.closed,this.__rememberedObjects.length>0&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=x(this)),a.folders={},o.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()}),a},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=x(this),A(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered[H]=x(this,!0)),this.load.remembered[a]=x(this),this.preset=a,y(this,a,!0),this.saveToLocalStorageIfPossible()},revert:function(a){o.each(this.__controllers,function(b){this.getRoot().load.remembered?s(a||this.getRoot(),b):b.setValue(b.initialValue)},this),o.each(this.__folders,function(a){a.revert(a)}),a||A(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a),b&&B(this.__listening)}}),M}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg.ac {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 0;\n    z-index: 0; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      position: absolute;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: right;\n    margin-right: 15px;\n    overflow-x: hidden; }\n    .dg.a.has-save > ul {\n      margin-top: 27px; }\n      .dg.a.has-save > ul.closed {\n        margin-top: 0; }\n    .dg.a .save-row {\n      position: fixed;\n      top: 0;\n      z-index: 1002; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    overflow: hidden;\n    padding: 0 4px 0 5px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid rgba(0, 0, 0, 0); }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 9px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: black url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2fa1d6; }\n    .dg .cr.number input[type=text] {\n      color: #2fa1d6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text] {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text] {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2fa1d6; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n",dat.controllers.factory=function(a,b,c,d,e,f,g){return function(h,i){var j=h[i];return g.isArray(arguments[2])||g.isObject(arguments[2])?new a(h,i,arguments[2]):g.isNumber(j)?g.isNumber(arguments[2])&&g.isNumber(arguments[3])?new c(h,i,arguments[2],arguments[3]):new b(h,i,{min:arguments[2],max:arguments[3]}):g.isString(j)?new d(h,i):g.isFunction(j)?new e(h,i,""):g.isBoolean(j)?new f(h,i):void 0}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(a,b,c){var d=function(a,c){function e(){g.setValue(g.__input.value)}function f(){g.__onFinishChange&&g.__onFinishChange.call(g,g.getValue())}d.superclass.call(this,a,c);var g=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),b.bind(this.__input,"keyup",e),b.bind(this.__input,"change",e),b.bind(this.__input,"blur",f),b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return d.superclass=a,c.extend(d.prototype,a.prototype,{updateDisplay:function(){return b.isActive(this.__input)||(this.__input.value=this.getValue()),d.superclass.prototype.updateDisplay.call(this)}}),d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(a,b,c,d,e){function f(a,b,c,d){a.style.background="",e.each(i,function(e){a.style.cssText+="background: "+e+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%); "})}function g(a){a.style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(a,i){function j(a){n(a),b.bind(window,"mousemove",n),b.bind(window,"mouseup",k)}function k(){b.unbind(window,"mousemove",n),b.unbind(window,"mouseup",k)}function l(){var a=d(this.value);a!==!1?(p.__color.__state=a,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString()}function m(){b.unbind(window,"mousemove",o),b.unbind(window,"mouseup",m)}function n(a){a.preventDefault();var c=b.getWidth(p.__saturation_field),d=b.getOffset(p.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c,f=1-(a.clientY-d.top+document.body.scrollTop)/c;return f>1?f=1:0>f&&(f=0),e>1?e=1:0>e&&(e=0),p.__color.v=f,p.__color.s=e,p.setValue(p.__color.toOriginal()),!1}function o(a){a.preventDefault();var c=b.getHeight(p.__hue_field),d=b.getOffset(p.__hue_field),e=1-(a.clientY-d.top+document.body.scrollTop)/c;return e>1?e=1:0>e&&(e=0),p.__color.h=360*e,p.setValue(p.__color.toOriginal()),!1}h.superclass.call(this,a,i),this.__color=new c(this.getValue()),this.__temp=new c(0);var p=this;this.domElement=document.createElement("div"),b.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",b.bind(this.__input,"keydown",function(a){13===a.keyCode&&l.call(this)}),b.bind(this.__input,"blur",l),b.bind(this.__selector,"mousedown",function(){b.addClass(this,"drag").bind(window,"mouseup",function(){b.removeClass(p.__selector,"drag")})});var q=document.createElement("div");e.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),e.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),e.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),e.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),e.extend(q.style,{width:"100%",height:"100%",background:"none"}),f(q,"top","rgba(0,0,0,0)","#000"),e.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),g(this.__hue_field),e.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),b.bind(this.__saturation_field,"mousedown",j),b.bind(this.__field_knob,"mousedown",j),b.bind(this.__hue_field,"mousedown",function(a){o(a),b.bind(window,"mousemove",o),b.bind(window,"mouseup",m)}),this.__saturation_field.appendChild(q),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};h.superclass=a,e.extend(h.prototype,a.prototype,{updateDisplay:function(){var a=d(this.getValue());if(a!==!1){var b=!1;e.each(c.COMPONENTS,function(c){return e.isUndefined(a[c])||e.isUndefined(this.__color.__state[c])||a[c]===this.__color.__state[c]?void 0:(b=!0,{})},this),b&&e.extend(this.__color.__state,a)}e.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var g=this.__color.v<.5||this.__color.s>.5?255:0,h=255-g;e.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+g+","+g+","+g+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,f(this.__saturation_field,"left","#fff",this.__temp.toString()),e.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+g+","+g+","+g+")",textShadow:this.__input_textShadow+"rgba("+h+","+h+","+h+",.7)"})}});var i=["-moz-","-o-","-webkit-","-ms-",""];return h}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(a,b,c,d){function e(a,b,c){Object.defineProperty(a,b,{get:function(){return"RGB"===this.__state.space?this.__state[b]:(g(this,b,c),this.__state[b])},set:function(a){"RGB"!==this.__state.space&&(g(this,b,c),this.__state.space="RGB"),this.__state[b]=a}})}function f(a,b){Object.defineProperty(a,b,{get:function(){return"HSV"===this.__state.space?this.__state[b]:(h(this),this.__state[b])},set:function(a){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV"),this.__state[b]=a}})}function g(a,c,e){if("HEX"===a.__state.space)a.__state[c]=b.component_from_hex(a.__state.hex,e);else{if("HSV"!==a.__state.space)throw"Corrupted color state";d.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v))}}function h(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);d.extend(a.__state,{s:c.s,v:c.v}),d.isNaN(c.h)?d.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var i=function(){if(this.__state=a.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return i.COMPONENTS=["r","g","b","h","s","v","hex","a"],d.extend(i.prototype,{toString:function(){return c(this)
},toOriginal:function(){return this.__state.conversion.write(this)}}),e(i.prototype,"r",2),e(i.prototype,"g",1),e(i.prototype,"b",0),f(i.prototype,"h"),f(i.prototype,"s"),f(i.prototype,"v"),Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}}),Object.defineProperty(i.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=b.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(a){this.__state.space="HEX",this.__state.hex=a}}),i}(dat.color.interpret,dat.color.math=function(){var a;return{hsv_to_rgb:function(a,b,c){var d=Math.floor(a/60)%6,e=a/60-Math.floor(a/60),f=c*(1-b),g=c*(1-e*b),h=c*(1-(1-e)*b),i=[[c,h,f],[g,c,f],[f,c,h],[f,g,c],[h,f,c],[c,f,g]][d];return{r:255*i[0],g:255*i[1],b:255*i[2]}},rgb_to_hsv:function(a,b,c){var d,e,f=Math.min(a,b,c),g=Math.max(a,b,c),h=g-f;return 0==g?{h:0/0,s:0,v:0}:(e=h/g,d=a==g?(b-c)/h:b==g?2+(c-a)/h:4+(a-b)/h,d/=6,0>d&&(d+=1),{h:360*d,s:e,v:g/255})},rgb_to_hex:function(a,b,c){var d=this.hex_with_component(0,2,a);return d=this.hex_with_component(d,1,b),d=this.hex_with_component(d,0,c)},component_from_hex:function(a,b){return a>>8*b&255},hex_with_component:function(b,c,d){return d<<(a=8*c)|b&~(255<<a)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),dat.dom.CenteredDiv=function(a,b){var c=function(){this.backgroundElement=document.createElement("div"),b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),a.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var c=this;a.bind(this.backgroundElement,"click",function(){c.hide()})};return c.prototype.show=function(){var a=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),b.defer(function(){a.backgroundElement.style.opacity=1,a.domElement.style.opacity=1,a.domElement.style.webkitTransform="scale(1)"})},c.prototype.hide=function(){var b=this,c=function(){b.domElement.style.display="none",b.backgroundElement.style.display="none",a.unbind(b.domElement,"webkitTransitionEnd",c),a.unbind(b.domElement,"transitionend",c),a.unbind(b.domElement,"oTransitionEnd",c)};a.bind(this.domElement,"webkitTransitionEnd",c),a.bind(this.domElement,"transitionend",c),a.bind(this.domElement,"oTransitionEnd",c),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},c.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-a.getHeight(this.domElement)/2+"px"},c}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a,b){"use strict";if(!a.jstree){var c,d,e=0,f=!1,g=!1,h=!1,i=[],j=a("script:last").attr("src"),k=document,l=k.createElement("LI");l.setAttribute("role","treeitem"),c=k.createElement("I"),c.className="jstree-icon jstree-ocl",l.appendChild(c),c=k.createElement("A"),c.className="jstree-anchor",c.setAttribute("href","#"),d=k.createElement("I"),d.className="jstree-icon jstree-themeicon",c.appendChild(d),l.appendChild(c),c=d=null,a.jstree={version:"3.0.0",defaults:{plugins:[]},plugins:{},path:j&&-1!==j.indexOf("/")?j.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&'".,=\- \/]/g},a.jstree.create=function(b,c){var d=new a.jstree.core(++e),f=c;return c=a.extend(!0,{},a.jstree.defaults,c),f&&f.plugins&&(c.plugins=f.plugins),a.each(c.plugins,function(a,b){"core"!==a&&(d=d.plugin(b,c[b]))}),d.init(b,c),d},a.jstree.core=function(a){this._id=a,this._cnt=0,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{}}}},a.jstree.reference=function(c){var d=null,e=null;if(c&&c.id&&(c=c.id),!e||!e.length)try{e=a(c)}catch(f){}if(!e||!e.length)try{e=a("#"+c.replace(a.jstree.idregex,"\\$&"))}catch(f){}return e&&e.length&&(e=e.closest(".jstree")).length&&(e=e.data("jstree"))?d=e:a(".jstree").each(function(){var e=a(this).data("jstree");return e&&e._model.data[c]?(d=e,!1):b}),d},a.fn.jstree=function(c){var d="string"==typeof c,e=Array.prototype.slice.call(arguments,1),f=null;return this.each(function(){var g=a.jstree.reference(this),h=d&&g?g[c]:null;return f=d&&h?h.apply(g,e):null,g||d||c!==b&&!a.isPlainObject(c)||a(this).data("jstree",new a.jstree.create(this,c)),(g&&!d||c===!0)&&(f=g||!1),null!==f&&f!==b?!1:b}),null!==f&&f!==b?f:this},a.expr[":"].jstree=a.expr.createPseudo(function(){return function(c){return a(c).hasClass("jstree")&&a(c).data("jstree")!==b}}),a.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:a.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!0},expand_selected_onload:!0},a.jstree.core.prototype={plugin:function(b,c){var d=a.jstree.plugins[b];return d?(this._data[b]={},d.prototype=this,new d(c,this)):this},init:function(b,c){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=a(b).addClass("jstree jstree-"+this._id),this.settings=c,this.element.bind("destroyed",a.proxy(this.teardown,this)),this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||18,this.trigger("loading"),this.load_node("#")},destroy:function(){this.element.unbind("destroyed",this.teardown),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(b){}}}).on("click.jstree",".jstree-ocl",a.proxy(function(a){this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",a.proxy(function(b){b.preventDefault(),a(b.currentTarget).focus(),this.activate_node(b.currentTarget,b)},this)).on("keydown.jstree",".jstree-anchor",a.proxy(function(b){if("INPUT"===b.target.tagName)return!0;var c=null;switch(b.which){case 13:case 32:b.type="click",a(b.currentTarget).trigger(b);break;case 37:b.preventDefault(),this.is_open(b.currentTarget)?this.close_node(b.currentTarget):(c=this.get_prev_dom(b.currentTarget),c&&c.length&&c.children(".jstree-anchor").focus());break;case 38:b.preventDefault(),c=this.get_prev_dom(b.currentTarget),c&&c.length&&c.children(".jstree-anchor").focus();break;case 39:b.preventDefault(),this.is_closed(b.currentTarget)?this.open_node(b.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):(c=this.get_next_dom(b.currentTarget),c&&c.length&&c.children(".jstree-anchor").focus());break;case 40:b.preventDefault(),c=this.get_next_dom(b.currentTarget),c&&c.length&&c.children(".jstree-anchor").focus();break;case 46:b.preventDefault(),c=this.get_node(b.currentTarget),c&&c.id&&"#"!==c.id&&(c=this.is_selected(c)?this.get_selected():c);break;case 113:b.preventDefault(),c=this.get_node(b.currentTarget)}},this)).on("load_node.jstree",a.proxy(function(b,c){if(c.status&&("#"!==c.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length)){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var d,e,f=[];for(d=0,e=this._data.core.selected.length;e>d;d++)f=f.concat(this._model.data[this._data.core.selected[d]].parents);for(f=a.vakata.array_unique(f),d=0,e=f.length;e>d;d++)this.open_node(f[d],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(a.proxy(function(){this.trigger("ready")},this),0)}},this)).on("init.jstree",a.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots,this._data.core.themes.stripes=a.stripes,this._data.core.themes.icons=a.icons,this.set_theme(a.name||"default",a.url),this.set_theme_variant(a.variant)},this)).on("loading.jstree",a.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("focus.jstree",".jstree-anchor",a.proxy(function(b){this.element.find(".jstree-hovered").not(b.currentTarget).mouseleave(),a(b.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",a.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",a.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),a(document).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={}),b.instance=this,this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children("ul:eq(0)")},get_string:function(b){var c=this.settings.core.strings;return a.isFunction(c)?c.call(this,b):c&&c[b]?c[b]:b},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(b,c){b&&b.id&&(b=b.id);var d;try{if(this._model.data[b])b=this._model.data[b];else if(((d=a(b,this.element)).length||(d=a("#"+b.replace(a.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[d.closest("li").attr("id")])b=this._model.data[d.closest("li").attr("id")];else{if(!(d=a(b,this.element)).length||!d.hasClass("jstree"))return!1;b=this._model.data["#"]}return c&&(b="#"===b.id?this.element:a("#"+b.id.replace(a.jstree.idregex,"\\$&"),this.element)),b}catch(e){return!1}},get_path:function(a,b,c){if(a=a.parents?a:this.get_node(a),!a||"#"===a.id||!a.parents)return!1;var d,e,f=[];for(f.push(c?a.id:a.text),d=0,e=a.parents.length;e>d;d++)f.push(c?a.parents[d]:this.get_text(a.parents[d]));return f=f.reverse().slice(1),b?f.join(b):f},get_next_dom:function(b,c){var d;return b=this.get_node(b,!0),b[0]===this.element[0]?(d=this._firstChild(this.get_container_ul()[0]),d?a(d):!1):b&&b.length?c?(d=this._nextSibling(b[0]),d?a(d):!1):b.hasClass("jstree-open")?(d=this._firstChild(b.children("ul")[0]),d?a(d):!1):null!==(d=this._nextSibling(b[0]))?a(d):b.parentsUntil(".jstree","li").next("li").eq(0):!1},get_prev_dom:function(b,c){var d;if(b=this.get_node(b,!0),b[0]===this.element[0])return d=this.get_container_ul()[0].lastChild,d?a(d):!1;if(!b||!b.length)return!1;if(c)return d=this._previousSibling(b[0]),d?a(d):!1;if(null!==(d=this._previousSibling(b[0]))){for(b=a(d);b.hasClass("jstree-open");)b=b.children("ul:eq(0)").children("li:last");return b}return d=b[0].parentNode.parentNode,d&&"LI"===d.tagName?a(d):!1},get_parent:function(a){return a=this.get_node(a),a&&"#"!==a.id?a.parent:!1},get_children_dom:function(a){return a=this.get_node(a,!0),a[0]===this.element[0]?this.get_container_ul().children("li"):a&&a.length?a.children("ul").children("li"):!1},is_parent:function(a){return a=this.get_node(a),a&&(a.state.loaded===!1||a.children.length>0)},is_loaded:function(a){return a=this.get_node(a),a&&a.state.loaded},is_loading:function(a){return a=this.get_node(a),a&&a.state&&a.state.loading},is_open:function(a){return a=this.get_node(a),a&&a.state.opened},is_closed:function(a){return a=this.get_node(a),a&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(b,c){var d,e,f,g,h,i,j;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.load_node(b[d],c);return!0}if(b=this.get_node(b),!b)return c&&c.call(this,b,!1),!1;if(b.state.loaded){for(b.state.loaded=!1,f=0,g=b.children_d.length;g>f;f++){for(h=0,i=b.parents.length;i>h;h++)this._model.data[b.parents[h]].children_d=a.vakata.array_remove_item(this._model.data[b.parents[h]].children_d,b.children_d[f]);this._model.data[b.children_d[f]].state.selected&&(j=!0,this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,b.children_d[f])),delete this._model.data[b.children_d[f]]}b.children=[],b.children_d=[],j&&this.trigger("changed",{action:"load_node",node:b,selected:this._data.core.selected})}return b.state.loading=!0,this.get_node(b,!0).addClass("jstree-loading"),this._load_node(b,a.proxy(function(a){b.state.loading=!1,b.state.loaded=a;var d=this.get_node(b,!0);b.state.loaded&&!b.children.length&&d&&d.length&&!d.hasClass("jstree-leaf")&&d.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),d.removeClass("jstree-loading"),this.trigger("load_node",{node:b,status:a}),c&&c.call(this,b,a)},this)),!0},_load_nodes:function(a,b,c){var d,e,f=!0,g=function(){this._load_nodes(a,b,!0)},h=this._model.data;for(d=0,e=a.length;e>d;d++)!h[a[d]]||h[a[d]].state.loaded&&c||(this.is_loading(a[d])||this.load_node(a[d],g),f=!1);f&&(b.done||(b.call(this,a),b.done=!0))},_load_node:function(b,c){var d,e=this.settings.core.data;return e?a.isFunction(e)?e.call(this,b,a.proxy(function(d){return d===!1?c.call(this,!1):c.call(this,this["string"==typeof d?"_append_html_data":"_append_json_data"](b,"string"==typeof d?a(d):d))},this)):"object"==typeof e?e.url?(e=a.extend(!0,{},e),a.isFunction(e.url)&&(e.url=e.url.call(this,b)),a.isFunction(e.data)&&(e.data=e.data.call(this,b)),a.ajax(e).done(a.proxy(function(d,e,f){var g=f.getResponseHeader("Content-Type");return-1!==g.indexOf("json")||"object"==typeof d?c.call(this,this._append_json_data(b,d)):-1!==g.indexOf("html")||"string"==typeof d?c.call(this,this._append_html_data(b,a(d))):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:b.id,xhr:f})},c.call(this,!1))},this)).fail(a.proxy(function(a){c.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:b.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(d=a.isArray(e)||a.isPlainObject(e)?JSON.parse(JSON.stringify(e)):e,"#"!==b.id&&(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:b.id})}),c.call(this,"#"===b.id?this._append_json_data(b,d):!1)):"string"==typeof e?("#"!==b.id&&(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:b.id})}),c.call(this,"#"===b.id?this._append_html_data(b,a(e)):!1)):c.call(this,!1):c.call(this,"#"===b.id?this._append_html_data(b,this._data.core.original_container_html.clone(!0)):!1)},_node_changed:function(a){a=this.get_node(a),a&&this._model.changed.push(a.id)},_append_html_data:function(b,c){b=this.get_node(b),b.children=[],b.children_d=[];var d,e,f,g=c.is("ul")?c.children():c,h=b.id,i=[],j=[],k=this._model.data,l=k[h],m=this._data.core.selected.length;for(g.each(a.proxy(function(b,c){d=this._parse_model_from_html(a(c),h,l.parents.concat()),d&&(i.push(d),j.push(d),k[d].children_d.length&&(j=j.concat(k[d].children_d)))},this)),l.children=i,l.children_d=j,e=0,f=l.parents.length;f>e;e++)k[l.parents[e]].children_d=k[l.parents[e]].children_d.concat(j);return this.trigger("model",{nodes:j,parent:h}),"#"!==h?(this._node_changed(h),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==m&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),!0},_append_json_data:function(c,d){c=this.get_node(c),c.children=[],c.children_d=[];var e,f,g,h=d,i=c.id,j=[],k=[],l=this._model.data,m=l[i],n=this._data.core.selected.length;if(h.d&&(h=h.d,"string"==typeof h&&(h=JSON.parse(h))),a.isArray(h)||(h=[h]),h.length&&h[0].id!==b&&h[0].parent!==b){for(f=0,g=h.length;g>f;f++)h[f].children||(h[f].children=[]),l[""+h[f].id]=h[f];for(f=0,g=h.length;g>f;f++)l[""+h[f].parent].children.push(""+h[f].id),m.children_d.push(""+h[f].id);for(f=0,g=m.children.length;g>f;f++)e=this._parse_model_from_flat_json(l[m.children[f]],i,m.parents.concat()),k.push(e),l[e].children_d.length&&(k=k.concat(l[e].children_d))}else{for(f=0,g=h.length;g>f;f++)e=this._parse_model_from_json(h[f],i,m.parents.concat()),e&&(j.push(e),k.push(e),l[e].children_d.length&&(k=k.concat(l[e].children_d)));for(m.children=j,m.children_d=k,f=0,g=m.parents.length;g>f;f++)l[m.parents[f]].children_d=l[m.parents[f]].children_d.concat(k)}return this.trigger("model",{nodes:k,parent:i}),"#"!==i?(this._node_changed(i),this.redraw()):this.redraw(!0),this._data.core.selected.length!==n&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),!0},_parse_model_from_html:function(c,d,e){e=e?[].concat(e):[],d&&e.unshift(d);var f,g,h,i,j,k=this._model.data,l={id:!1,text:!1,icon:!0,parent:d,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(h in this._model.default_state)this._model.default_state.hasOwnProperty(h)&&(l.state[h]=this._model.default_state[h]);if(i=a.vakata.attributes(c,!0),a.each(i,function(c,d){return d=a.trim(d),d.length?(l.li_attr[c]=d,"id"===c&&(l.id=""+d),b):!0}),i=c.children("a").eq(0),i.length&&(i=a.vakata.attributes(i,!0),a.each(i,function(b,c){c=a.trim(c),c.length&&(l.a_attr[b]=c)})),i=c.children("a:eq(0)").length?c.children("a:eq(0)").clone():c.clone(),i.children("ins, i, ul").remove(),i=i.html(),i=a("<div />").html(i),l.text=i.html(),i=c.data(),l.data=i?a.extend(!0,{},i):null,l.state.opened=c.hasClass("jstree-open"),l.state.selected=c.children("a").hasClass("jstree-clicked"),l.state.disabled=c.children("a").hasClass("jstree-disabled"),l.data&&l.data.jstree)for(h in l.data.jstree)l.data.jstree.hasOwnProperty(h)&&(l.state[h]=l.data.jstree[h]);i=c.children("a").children(".jstree-themeicon"),i.length&&(l.icon=i.hasClass("jstree-themeicon-hidden")?!1:i.attr("rel")),l.state.icon&&(l.icon=l.state.icon),i=c.children("ul").children("li");do j="j"+this._id+"_"+ ++this._cnt;while(k[j]);return l.id=l.li_attr.id?""+l.li_attr.id:j,i.length?(i.each(a.proxy(function(b,c){f=this._parse_model_from_html(a(c),l.id,e),g=this._model.data[f],l.children.push(f),g.children_d.length&&(l.children_d=l.children_d.concat(g.children_d))},this)),l.children_d=l.children_d.concat(l.children)):c.hasClass("jstree-closed")&&(l.state.loaded=!1),l.li_attr["class"]&&(l.li_attr["class"]=l.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),l.a_attr["class"]&&(l.a_attr["class"]=l.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),k[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_flat_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e,f,g,h,i=""+a.id,j=this._model.data,k=this._model.default_state,l={id:i,text:a.text||"",icon:a.icon!==b?a.icon:!0,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in k)k.hasOwnProperty(e)&&(l.state[e]=k[e]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),a&&a.data&&(l.data=a.data,a.data.jstree))for(e in a.data.jstree)a.data.jstree.hasOwnProperty(e)&&(l.state[e]=a.data.jstree[e]);if(a&&"object"==typeof a.state)for(e in a.state)a.state.hasOwnProperty(e)&&(l.state[e]=a.state[e]);if(a&&"object"==typeof a.li_attr)for(e in a.li_attr)a.li_attr.hasOwnProperty(e)&&(l.li_attr[e]=a.li_attr[e]);if(l.li_attr.id||(l.li_attr.id=i),a&&"object"==typeof a.a_attr)for(e in a.a_attr)a.a_attr.hasOwnProperty(e)&&(l.a_attr[e]=a.a_attr[e]);for(a&&a.children&&a.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),j[l.id]=l,e=0,f=l.children.length;f>e;e++)g=this._parse_model_from_flat_json(j[l.children[e]],l.id,d),h=j[g],l.children_d.push(g),h.children_d.length&&(l.children_d=l.children_d.concat(h.children_d));return delete a.data,delete a.children,j[l.id].original=a,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e,f,g,h,i,j=!1,k=this._model.data,l=this._model.default_state;do j="j"+this._id+"_"+ ++this._cnt;while(k[j]);i={id:!1,text:"string"==typeof a?a:"",icon:"object"==typeof a&&a.icon!==b?a.icon:!0,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in l)l.hasOwnProperty(e)&&(i.state[e]=l[e]);if(a&&a.id&&(i.id=""+a.id),a&&a.text&&(i.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(i.icon=a.data.jstree.icon),a&&a.data&&(i.data=a.data,a.data.jstree))for(e in a.data.jstree)a.data.jstree.hasOwnProperty(e)&&(i.state[e]=a.data.jstree[e]);if(a&&"object"==typeof a.state)for(e in a.state)a.state.hasOwnProperty(e)&&(i.state[e]=a.state[e]);if(a&&"object"==typeof a.li_attr)for(e in a.li_attr)a.li_attr.hasOwnProperty(e)&&(i.li_attr[e]=a.li_attr[e]);if(i.li_attr.id&&!i.id&&(i.id=""+i.li_attr.id),i.id||(i.id=j),i.li_attr.id||(i.li_attr.id=i.id),a&&"object"==typeof a.a_attr)for(e in a.a_attr)a.a_attr.hasOwnProperty(e)&&(i.a_attr[e]=a.a_attr[e]);if(a&&a.children&&a.children.length){for(e=0,f=a.children.length;f>e;e++)g=this._parse_model_from_json(a.children[e],i.id,d),h=k[g],i.children.push(g),h.children_d.length&&(i.children_d=i.children_d.concat(h.children_d));i.children_d=i.children_d.concat(i.children)}return a&&a.children&&a.children===!0&&(i.state.loaded=!1,i.children=[],i.children_d=[]),delete a.data,delete a.children,i.original=a,k[i.id]=i,i.state.selected&&this._data.core.selected.push(i.id),i.id},_redraw:function(){var a,b,c,d=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),e=document.createElement("UL");for(b=0,c=d.length;c>b;b++)a=this.redraw_node(d[b],!0,this._model.force_full_redraw),a&&this._model.force_full_redraw&&e.appendChild(a);this._model.force_full_redraw&&(e.className=this.get_container_ul()[0].className,this.element.empty().append(e)),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:d})},redraw:function(a){a&&(this._model.force_full_redraw=!0),this._redraw()},redraw_node:function(b,c,d){var e=this.get_node(b),f=!1,g=!1,h=!1,i=!1,j=!1,k=!1,m="",n=document,o=this._model.data,p=!1,q=!1;if(!e)return!1;if("#"===e.id)return this.redraw(!0);if(c=c||0===e.children.length,b=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(e.id[0])?"\\3"+e.id[0]+" "+e.id.substr(1).replace(a.jstree.idregex,"\\$&"):e.id.replace(a.jstree.idregex,"\\$&"))):document.getElementById(e.id))b=a(b),d||(f=b.parent().parent()[0],f===this.element[0]&&(f=null),g=b.index()),c||!e.children.length||b.children("ul").length||(c=!0),c||(h=b.children("UL")[0]),q=b.attr("aria-selected"),p=b.children(".jstree-anchor")[0]===document.activeElement,b.remove();else if(c=!0,!d){if(f="#"!==e.parent?a("#"+e.parent.replace(a.jstree.idregex,"\\$&"),this.element)[0]:null,!(null===f||f&&o[e.parent].state.opened))return!1;g=a.inArray(e.id,null===f?o["#"].children:o[e.parent].children)}b=l.cloneNode(!0),m="jstree-node ";for(i in e.li_attr)if(e.li_attr.hasOwnProperty(i)){if("id"===i)continue;"class"!==i?b.setAttribute(i,e.li_attr[i]):m+=e.li_attr[i]}q&&"false"!==q&&b.setAttribute("aria-selected",!0),e.state.loaded&&!e.children.length?m+=" jstree-leaf":(m+=e.state.opened&&e.state.loaded?" jstree-open":" jstree-closed",b.setAttribute("aria-expanded",e.state.opened&&e.state.loaded)),null!==e.parent&&o[e.parent].children[o[e.parent].children.length-1]===e.id&&(m+=" jstree-last"),b.id=e.id,b.className=m,m=(e.state.selected?" jstree-clicked":"")+(e.state.disabled?" jstree-disabled":"");for(j in e.a_attr)if(e.a_attr.hasOwnProperty(j)){if("href"===j&&"#"===e.a_attr[j])continue;"class"!==j?b.childNodes[1].setAttribute(j,e.a_attr[j]):m+=" "+e.a_attr[j]}if(m.length&&(b.childNodes[1].className="jstree-anchor "+m),(e.icon&&e.icon!==!0||e.icon===!1)&&(e.icon===!1?b.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===e.icon.indexOf("/")&&-1===e.icon.indexOf(".")?b.childNodes[1].childNodes[0].className+=" "+e.icon+" jstree-themeicon-custom":(b.childNodes[1].childNodes[0].style.backgroundImage="url("+e.icon+")",b.childNodes[1].childNodes[0].style.backgroundPosition="center center",b.childNodes[1].childNodes[0].style.backgroundSize="auto",b.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),b.childNodes[1].innerHTML+=e.text,c&&e.children.length&&e.state.opened&&e.state.loaded){for(k=n.createElement("UL"),k.setAttribute("role","group"),k.className="jstree-children",i=0,j=e.children.length;j>i;i++)k.appendChild(this.redraw_node(e.children[i],c,!0));b.appendChild(k)}return h&&b.appendChild(h),d||(f||(f=this.element[0]),f.getElementsByTagName("UL").length?f=f.getElementsByTagName("UL")[0]:(i=n.createElement("UL"),i.setAttribute("role","group"),i.className="jstree-children",f.appendChild(i),f=i),f.childNodes.length>g?f.insertBefore(b,f.childNodes[g]):f.appendChild(b),p&&b.childNodes[1].focus()),e.state.opened&&!e.state.loaded&&(e.state.opened=!1,setTimeout(a.proxy(function(){this.open_node(e.id,!1,0)},this),0)),b},open_node:function(c,d,e){var f,g,h,i;if(a.isArray(c)){for(c=c.slice(),f=0,g=c.length;g>f;f++)this.open_node(c[f],d,e);return!0}if(c=this.get_node(c),!c||"#"===c.id)return!1;if(e=e===b?this.settings.core.animation:e,!this.is_closed(c))return d&&d.call(this,c,!1),!1;if(this.is_loaded(c))h=this.get_node(c,!0),i=this,h.length&&(c.children.length&&!this._firstChild(h.children("ul")[0])&&(c.state.opened=!0,this.redraw_node(c,!0),h=this.get_node(c,!0)),e?(this.trigger("before_open",{node:c}),h.children("ul").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children("ul").stop(!0,!0).slideDown(e,function(){this.style.display="",i.trigger("after_open",{node:c})})):(this.trigger("before_open",{node:c}),h[0].className=h[0].className.replace("jstree-closed","jstree-open"),h[0].setAttribute("aria-expanded",!0))),c.state.opened=!0,d&&d.call(this,c,!0),h.length||this.trigger("before_open",{node:c}),this.trigger("open_node",{node:c}),e&&h.length||this.trigger("after_open",{node:c});else{if(this.is_loading(c))return setTimeout(a.proxy(function(){this.open_node(c,d,e)},this),500);this.load_node(c,function(a,b){return b?this.open_node(a,d,e):d?d.call(this,a,!1):!1})}},_open_to:function(b){if(b=this.get_node(b),!b||"#"===b.id)return!1;var c,d,e=b.parents;for(c=0,d=e.length;d>c;c+=1)"#"!==c&&this.open_node(e[c],!1,0);return a("#"+b.id.replace(a.jstree.idregex,"\\$&"),this.element)},close_node:function(c,d){var e,f,g,h;if(a.isArray(c)){for(c=c.slice(),e=0,f=c.length;f>e;e++)this.close_node(c[e],d);return!0}return c=this.get_node(c),c&&"#"!==c.id?this.is_closed(c)?!1:(d=d===b?this.settings.core.animation:d,g=this,h=this.get_node(c,!0),h.length&&(d?h.children("ul").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children("ul").stop(!0,!0).slideUp(d,function(){this.style.display="",h.children("ul").remove(),g.trigger("after_close",{node:c})}):(h[0].className=h[0].className.replace("jstree-open","jstree-closed"),h.attr("aria-expanded",!1).children("ul").remove())),c.state.opened=!1,this.trigger("close_node",{node:c}),d&&h.length||this.trigger("after_close",{node:c}),b):!1},toggle_node:function(c){var d,e;if(a.isArray(c)){for(c=c.slice(),d=0,e=c.length;e>d;d++)this.toggle_node(c[d]);return!0}return this.is_closed(c)?this.open_node(c):this.is_open(c)?this.close_node(c):b},open_all:function(a,b,c){if(a||(a="#"),a=this.get_node(a),!a)return!1;var d,e,f,g="#"===a.id?this.get_container_ul():this.get_node(a,!0);if(!g.length){for(d=0,e=a.children_d.length;e>d;d++)this.is_closed(this._model.data[a.children_d[d]])&&(this._model.data[a.children_d[d]].state.opened=!0);return this.trigger("open_all",{node:a})}c=c||g,f=this,g=this.is_closed(a)?g.find("li.jstree-closed").addBack():g.find("li.jstree-closed"),g.each(function(){f.open_node(this,function(a,d){d&&this.is_parent(a)&&this.open_all(a,b,c)},b||0)}),0===c.find("li.jstree-closed").length&&this.trigger("open_all",{node:this.get_node(c)})},close_all:function(b,c){if(b||(b="#"),b=this.get_node(b),!b)return!1;var d,e,f="#"===b.id?this.get_container_ul():this.get_node(b,!0),g=this;if(!f.length){for(d=0,e=b.children_d.length;e>d;d++)this._model.data[b.children_d[d]].state.opened=!1;return this.trigger("close_all",{node:b})}f=this.is_open(b)?f.find("li.jstree-open").addBack():f.find("li.jstree-open"),a(f.get().reverse()).each(function(){g.close_node(this,c||0)}),this.trigger("close_all",{node:b})},is_disabled:function(a){return a=this.get_node(a),a&&a.state&&a.state.disabled},enable_node:function(c){var d,e;if(a.isArray(c)){for(c=c.slice(),d=0,e=c.length;e>d;d++)this.enable_node(c[d]);return!0}return c=this.get_node(c),c&&"#"!==c.id?(c.state.disabled=!1,this.get_node(c,!0).children(".jstree-anchor").removeClass("jstree-disabled"),this.trigger("enable_node",{node:c}),b):!1},disable_node:function(c){var d,e;if(a.isArray(c)){for(c=c.slice(),d=0,e=c.length;e>d;d++)this.disable_node(c[d]);return!0}return c=this.get_node(c),c&&"#"!==c.id?(c.state.disabled=!0,this.get_node(c,!0).children(".jstree-anchor").addClass("jstree-disabled"),this.trigger("disable_node",{node:c}),b):!1},activate_node:function(a,c){if(this.is_disabled(a))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==b?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&(!c.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(c.shiftKey){var d,e,f=this.get_node(a).id,g=this._data.core.last_clicked.id,h=this.get_node(this._data.core.last_clicked.parent).children,i=!1;for(d=0,e=h.length;e>d;d+=1)h[d]===f&&(i=!i),h[d]===g&&(i=!i),i||h[d]===f||h[d]===g?this.select_node(h[d],!1,!1,c):this.deselect_node(h[d],!1,!1,c)
}else this.is_selected(a)?this.deselect_node(a,!1,!1,c):this.select_node(a,!1,!1,c);else!this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,!1,c):(this.deselect_all(!0),this.select_node(a,!1,!1,c),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a)})},hover_node:function(a){if(a=this.get_node(a,!0),!a||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),c=this.element;b&&b.length&&this.dehover_node(b),a.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(a)}),setTimeout(function(){c.attr("aria-activedescendant",a[0].id),a.attr("aria-selected",!0)},0)},dehover_node:function(a){return a=this.get_node(a,!0),a&&a.length&&a.children(".jstree-hovered").length?(a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(a)}),b):!1},select_node:function(c,d,e,f){var g,h,i;if(a.isArray(c)){for(c=c.slice(),h=0,i=c.length;i>h;h++)this.select_node(c[h],d,e,f);return!0}return c=this.get_node(c),c&&"#"!==c.id?(g=this.get_node(c,!0),c.state.selected||(c.state.selected=!0,this._data.core.selected.push(c.id),e||(g=this._open_to(c)),g&&g.length&&g.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:c,selected:this._data.core.selected,event:f}),d||this.trigger("changed",{action:"select_node",node:c,selected:this._data.core.selected,event:f})),b):!1},deselect_node:function(c,d,e){var f,g,h;if(a.isArray(c)){for(c=c.slice(),f=0,g=c.length;g>f;f++)this.deselect_node(c[f],d,e);return!0}return c=this.get_node(c),c&&"#"!==c.id?(h=this.get_node(c,!0),c.state.selected&&(c.state.selected=!1,this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,c.id),h.length&&h.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:c,selected:this._data.core.selected,event:e}),d||this.trigger("changed",{action:"deselect_node",node:c,selected:this._data.core.selected,event:e})),b):!1},select_all:function(a){var b,c,d=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),b=0,c=this._data.core.selected.length;c>b;b++)this._model.data[this._data.core.selected[b]]&&(this._model.data[this._data.core.selected[b]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:d})},deselect_all:function(a){var b,c,d=this._data.core.selected.concat([]);for(b=0,c=this._data.core.selected.length;c>b;b++)this._model.data[this._data.core.selected[b]]&&(this._model.data[this._data.core.selected[b]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked"),this.trigger("deselect_all",{selected:this._data.core.selected,node:d}),a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:d})},is_selected:function(a){return a=this.get_node(a),a&&"#"!==a.id?a.state.selected:!1},get_selected:function(b){return b?a.map(this._data.core.selected,a.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected},get_top_selected:function(b){var c,d,e,f,g=this.get_selected(!0),h={};for(c=0,d=g.length;d>c;c++)h[g[c].id]=g[c];for(c=0,d=g.length;d>c;c++)for(e=0,f=g[c].children_d.length;f>e;e++)h[g[c].children_d[e]]&&delete h[g[c].children_d[e]];g=[];for(c in h)h.hasOwnProperty(c)&&g.push(c);return b?a.map(g,a.proxy(function(a){return this.get_node(a)},this)):g},get_bottom_selected:function(b){var c,d,e=this.get_selected(!0),f=[];for(c=0,d=e.length;d>c;c++)e[c].children.length||f.push(e[c].id);return b?a.map(f,a.proxy(function(a){return this.get_node(a)},this)):f},get_state:function(){var a,b={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(a in this._model.data)this._model.data.hasOwnProperty(a)&&"#"!==a&&(this._model.data[a].state.opened&&b.core.open.push(a),this._model.data[a].state.selected&&b.core.selected.push(a));return b},set_state:function(c,d){if(c){if(c.core){var e,f,g,h;if(c.core.open)return a.isArray(c.core.open)?(e=!0,f=!1,g=this,a.each(c.core.open.concat([]),function(b,h){f=g.get_node(h),f&&(g.is_loaded(h)?(g.is_closed(h)&&g.open_node(h,!1,0),c&&c.core&&c.core.open&&a.vakata.array_remove_item(c.core.open,h)):(g.is_loading(h)||g.open_node(h,a.proxy(function(b,e){!e&&c&&c.core&&c.core.open&&a.vakata.array_remove_item(c.core.open,b.id),this.set_state(c,d)},g),0),e=!1))}),e&&(delete c.core.open,this.set_state(c,d)),!1):(delete c.core.open,this.set_state(c,d),!1);if(c.core.scroll)return c.core.scroll&&c.core.scroll.left!==b&&this.element.scrollLeft(c.core.scroll.left),c.core.scroll&&c.core.scroll.top!==b&&this.element.scrollTop(c.core.scroll.top),delete c.core.scroll,this.set_state(c,d),!1;if(c.core.selected)return h=this,this.deselect_all(),a.each(c.core.selected,function(a,b){h.select_node(b)}),delete c.core.selected,this.set_state(c,d),!1;if(a.isEmptyObject(c.core))return delete c.core,this.set_state(c,d),!1}return a.isEmptyObject(c)?(c=null,d&&d.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(b){this._data.core.state=this.get_state(),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var c=this.get_container_ul()[0].className;b||this.element.html("<ul class='jstree-container-ul'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.load_node("#",function(b,d){d&&(this.get_container_ul()[0].className=c,this.set_state(a.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(b){if(b=this.get_node(b),!b||"#"===b.id)return!1;{var c=[];this._data.core.selected.concat([])}b.state.opened===!0&&c.push(b.id),this.get_node(b,!0).find(".jstree-open").each(function(){c.push(this.id)}),this._load_nodes(c,a.proxy(function(a){this.open_node(a,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:b,nodes:a})},this))},set_id:function(b,c){if(b=this.get_node(b),!b||"#"===b.id)return!1;var d,e,f=this._model.data;for(c=""+c,f[b.parent].children[a.inArray(b.id,f[b.parent].children)]=c,d=0,e=b.parents.length;e>d;d++)f[b.parents[d]].children_d[a.inArray(b.id,f[b.parents[d]].children_d)]=c;for(d=0,e=b.children.length;e>d;d++)f[b.children[d]].parent=c;for(d=0,e=b.children_d.length;e>d;d++)f[b.children_d[d]].parents[a.inArray(b.id,f[b.children_d[d]].parents)]=c;return d=a.inArray(b.id,this._data.core.selected),-1!==d&&(this._data.core.selected[d]=c),d=this.get_node(b.id,!0),d&&d.attr("id",c),delete f[b.id],b.id=c,f[c]=b,!0},get_text:function(a){return a=this.get_node(a),a&&"#"!==a.id?a.text:!1},set_text:function(b,c){var d,e,f,g;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.set_text(b[d],c);return!0}return b=this.get_node(b),b&&"#"!==b.id?(b.text=c,f=this.get_node(b,!0),f.length&&(f=f.children(".jstree-anchor:eq(0)"),g=f.children("I").clone(),f.html(c).prepend(g),this.trigger("set_text",{obj:b,text:c})),!0):!1},get_json:function(a,b,c){if(a=this.get_node(a||"#"),!a)return!1;b&&b.flat&&!c&&(c=[]);var d,e,f={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:a.li_attr,a_attr:a.a_attr,state:{},data:b&&b.no_data?!1:a.data};if(b&&b.flat?f.parent=a.parent:f.children=[],!b||!b.no_state)for(d in a.state)a.state.hasOwnProperty(d)&&(f.state[d]=a.state[d]);if(b&&b.no_id&&(delete f.id,f.li_attr&&f.li_attr.id&&delete f.li_attr.id),b&&b.flat&&"#"!==a.id&&c.push(f),!b||!b.no_children)for(d=0,e=a.children.length;e>d;d++)b&&b.flat?this.get_json(a.children[d],b,c):f.children.push(this.get_json(a.children[d],b));return b&&b.flat?c:"#"===a.id?f.children:f},create_node:function(c,d,e,f,g){if(null===c&&(c="#"),c=this.get_node(c),!c)return!1;if(e=e===b?"last":e,!(""+e).match(/^(before|after)$/)&&!g&&!this.is_loaded(c))return this.load_node(c,function(){this.create_node(c,d,e,f,!0)});d||(d={text:this.get_string("New node")}),d.text===b&&(d.text=this.get_string("New node"));var h,i,j,k;switch("#"===c.id&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":h=this.get_node(c.parent),e=a.inArray(c.id,h.children),c=h;break;case"after":h=this.get_node(c.parent),e=a.inArray(c.id,h.children)+1,c=h;break;case"inside":case"first":e=0;break;case"last":e=c.children.length;break;default:e||(e=0)}if(e>c.children.length&&(e=c.children.length),d.id||(d.id=!0),!this.check("create_node",d,c,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(d.id===!0&&delete d.id,d=this._parse_model_from_json(d,c.id,c.parents.concat()),!d)return!1;for(h=this.get_node(d),i=[],i.push(d),i=i.concat(h.children_d),this.trigger("model",{nodes:i,parent:c.id}),c.children_d=c.children_d.concat(i),j=0,k=c.parents.length;k>j;j++)this._model.data[c.parents[j]].children_d=this._model.data[c.parents[j]].children_d.concat(i);for(d=h,h=[],j=0,k=c.children.length;k>j;j++)h[j>=e?j+1:j]=c.children[j];return h[e]=d.id,c.children=h,this.redraw_node(c,!0),f&&f.call(this,this.get_node(d)),this.trigger("create_node",{node:this.get_node(d),parent:c.id,position:e}),d.id},rename_node:function(b,c){var d,e,f;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.rename_node(b[d],c);return!0}return b=this.get_node(b),b&&"#"!==b.id?(f=b.text,this.check("rename_node",b,this.get_parent(b),c)?(this.set_text(b,c),this.trigger("rename_node",{node:b,text:c,old:f}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(b){var c,d,e,f,g,h,i,j,k,l;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.delete_node(b[c]);return!0}if(b=this.get_node(b),!b||"#"===b.id)return!1;if(e=this.get_node(b.parent),f=a.inArray(b.id,e.children),l=!1,!this.check("delete_node",b,e,f))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==f&&(e.children=a.vakata.array_remove(e.children,f)),g=b.children_d.concat([]),g.push(b.id),j=0,k=g.length;k>j;j++){for(h=0,i=b.parents.length;i>h;h++)f=a.inArray(g[j],this._model.data[b.parents[h]].children_d),-1!==f&&(this._model.data[b.parents[h]].children_d=a.vakata.array_remove(this._model.data[b.parents[h]].children_d,f));this._model.data[g[j]].state.selected&&(l=!0,f=a.inArray(g[j],this._data.core.selected),-1!==f&&(this._data.core.selected=a.vakata.array_remove(this._data.core.selected,f)))}for(this.trigger("delete_node",{node:b,parent:e.id}),l&&this.trigger("changed",{action:"delete_node",node:b,selected:this._data.core.selected,parent:e.id}),j=0,k=g.length;k>j;j++)delete this._model.data[g[j]];return this.redraw_node(e,!0),!0},check:function(b,c,d,e,f){c=c&&c.id?c:this.get_node(c),d=d&&d.id?d:this.get_node(d);var g=b.match(/^move_node|copy_node|create_node$/i)?d:c,h=this.settings.core.check_callback;return"move_node"!==b&&"copy_node"!==b||f&&f.is_multi||c.id!==d.id&&a.inArray(c.id,d.children)!==e&&-1===a.inArray(d.id,c.children_d)?(g&&g.data&&(g=g.data),g&&g.functions&&(g.functions[b]===!1||g.functions[b]===!0)?(g.functions[b]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+b,data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})}),g.functions[b]):h===!1||a.isFunction(h)&&h.call(this,b,c,d,e,f)===!1||h&&h[b]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+b,data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})},!1):!0):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t;if(a.isArray(c)){for(c=c.reverse().slice(),h=0,i=c.length;i>h;h++)this.move_node(c[h],d,e,f,g);return!0}if(c=c&&c.id?c:this.get_node(c),d=this.get_node(d),e=e===b?0:e,!d||!c||"#"===c.id)return!1;if(!(""+e).match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.move_node(c,d,e,f,!0)});if(j=""+(c.parent||"#"),k=(""+e).match(/^(before|after)$/)&&"#"!==d.id?this.get_node(d.parent):d,l=c.instance?c.instance:this._model.data[c.id]?this:a.jstree.reference(c.id),m=!l||!l._id||this._id!==l._id)return this.copy_node(c,d,e,f,g)?(l&&l.delete_node(c),!0):!1;switch("#"===k.id&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":e=a.inArray(d.id,k.children);break;case"after":e=a.inArray(d.id,k.children)+1;break;case"inside":case"first":e=0;break;case"last":e=k.children.length;break;default:e||(e=0)}if(e>k.children.length&&(e=k.children.length),!this.check("move_node",c,k,e,{core:!0,is_multi:l&&l._id&&l._id!==this._id,is_foreign:!l||!l._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(c.parent===k.id){for(n=k.children.concat(),o=a.inArray(c.id,n),-1!==o&&(n=a.vakata.array_remove(n,o),e>o&&e--),o=[],p=0,q=n.length;q>p;p++)o[p>=e?p+1:p]=n[p];o[e]=c.id,k.children=o,this._node_changed(k.id),this.redraw("#"===k.id)}else{for(o=c.children_d.concat(),o.push(c.id),p=0,q=c.parents.length;q>p;p++){for(n=[],t=l._model.data[c.parents[p]].children_d,r=0,s=t.length;s>r;r++)-1===a.inArray(t[r],o)&&n.push(t[r]);l._model.data[c.parents[p]].children_d=n}for(l._model.data[j].children=a.vakata.array_remove_item(l._model.data[j].children,c.id),p=0,q=k.parents.length;q>p;p++)this._model.data[k.parents[p]].children_d=this._model.data[k.parents[p]].children_d.concat(o);for(n=[],p=0,q=k.children.length;q>p;p++)n[p>=e?p+1:p]=k.children[p];for(n[e]=c.id,k.children=n,k.children_d.push(c.id),k.children_d=k.children_d.concat(c.children_d),c.parent=k.id,o=k.parents.concat(),o.unshift(k.id),t=c.parents.length,c.parents=o,o=o.concat(),p=0,q=c.children_d.length;q>p;p++)this._model.data[c.children_d[p]].parents=this._model.data[c.children_d[p]].parents.slice(0,-1*t),Array.prototype.push.apply(this._model.data[c.children_d[p]].parents,o);this._node_changed(j),this._node_changed(k.id),this.redraw("#"===j||"#"===k.id)}return f&&f.call(this,c,k,e),this.trigger("move_node",{node:c,parent:k.id,position:e,old_parent:j,is_multi:l&&l._id&&l._id!==this._id,is_foreign:!l||!l._id,old_instance:l,new_instance:this}),!0},copy_node:function(c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r;if(a.isArray(c)){for(c=c.reverse().slice(),h=0,i=c.length;i>h;h++)this.copy_node(c[h],d,e,f,g);return!0}if(c=c&&c.id?c:this.get_node(c),d=this.get_node(d),e=e===b?0:e,!d||!c||"#"===c.id)return!1;if(!(""+e).match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.copy_node(c,d,e,f,!0)});switch(o=""+(c.parent||"#"),p=(""+e).match(/^(before|after)$/)&&"#"!==d.id?this.get_node(d.parent):d,q=c.instance?c.instance:this._model.data[c.id]?this:a.jstree.reference(c.id),r=!q||!q._id||this._id!==q._id,"#"===p.id&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":e=a.inArray(d.id,p.children);break;case"after":e=a.inArray(d.id,p.children)+1;break;case"inside":case"first":e=0;break;case"last":e=p.children.length;break;default:e||(e=0)}if(e>p.children.length&&(e=p.children.length),!this.check("copy_node",c,p,e,{core:!0,is_multi:q&&q._id&&q._id!==this._id,is_foreign:!q||!q._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(n=q?q.get_json(c,{no_id:!0,no_data:!0,no_state:!0}):c,!n)return!1;if(n.id===!0&&delete n.id,n=this._parse_model_from_json(n,p.id,p.parents.concat()),!n)return!1;for(k=this.get_node(n),c&&c.state&&c.state.loaded===!1&&(k.state.loaded=!1),j=[],j.push(n),j=j.concat(k.children_d),this.trigger("model",{nodes:j,parent:p.id}),l=0,m=p.parents.length;m>l;l++)this._model.data[p.parents[l]].children_d=this._model.data[p.parents[l]].children_d.concat(j);for(j=[],l=0,m=p.children.length;m>l;l++)j[l>=e?l+1:l]=p.children[l];return j[e]=k.id,p.children=j,p.children_d.push(k.id),p.children_d=p.children_d.concat(k.children_d),this._node_changed(p.id),this.redraw("#"===p.id),f&&f.call(this,k,p,e),this.trigger("copy_node",{node:k,original:c,parent:p.id,position:e,old_parent:o,is_multi:q&&q._id&&q._id!==this._id,is_foreign:!q||!q._id,old_instance:q,new_instance:this}),k.id},cut:function(c){if(c||(c=this._data.core.selected.concat()),a.isArray(c)||(c=[c]),!c.length)return!1;var d,e,i,j=[];for(e=0,i=c.length;i>e;e++)d=this.get_node(c[e]),d&&d.id&&"#"!==d.id&&j.push(d);return j.length?(f=j,h=this,g="move_node",this.trigger("cut",{node:c}),b):!1},copy:function(c){if(c||(c=this._data.core.selected.concat()),a.isArray(c)||(c=[c]),!c.length)return!1;var d,e,i,j=[];for(e=0,i=c.length;i>e;e++)d=this.get_node(c[e]),d&&d.id&&"#"!==d.id&&j.push(d);return j.length?(f=j,h=this,g="copy_node",this.trigger("copy",{node:c}),b):!1},get_buffer:function(){return{mode:g,node:f,inst:h}},can_paste:function(){return g!==!1&&f!==!1},paste:function(a,c){return a=this.get_node(a),a&&g&&g.match(/^(copy_node|move_node)$/)&&f?(this[g](f,a,c)&&this.trigger("paste",{parent:a.id,node:f,mode:g}),f=!1,g=!1,h=!1,b):!1},edit:function(c,d){if(c=this._open_to(c),!c||!c.length)return!1;var e=this._data.core.rtl,f=this.element.width(),g=c.children(".jstree-anchor"),h=a("<span>"),i="string"==typeof d?d:this.get_text(c),j=a("<div />",{css:{position:"absolute",top:"-200px",left:e?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),k=a("<input />",{value:i,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:a.proxy(function(){var a=h.children(".jstree-rename-input"),b=a.val();""===b&&(b=i),j.remove(),h.replaceWith(g),h.remove(),this.set_text(c,i),this.rename_node(c,b)===!1&&this.set_text(c,i)},this),keydown:function(a){var b=a.which;27===b&&(this.value=i),(27===b||13===b||37===b||38===b||39===b||40===b||32===b)&&a.stopImmediatePropagation(),(27===b||13===b)&&(a.preventDefault(),this.blur())},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(){k.width(Math.min(j.text("pW"+this.value).width(),f))},keypress:function(a){return 13===a.which?!1:b}}),l={fontFamily:g.css("fontFamily")||"",fontSize:g.css("fontSize")||"",fontWeight:g.css("fontWeight")||"",fontStyle:g.css("fontStyle")||"",fontStretch:g.css("fontStretch")||"",fontVariant:g.css("fontVariant")||"",letterSpacing:g.css("letterSpacing")||"",wordSpacing:g.css("wordSpacing")||""};this.set_text(c,""),h.attr("class",g.attr("class")).append(g.contents().clone()).append(k),g.replaceWith(h),j.css(l),k.css(l).width(Math.min(j.text("pW"+k[0].value).width(),f))[0].select()},set_theme:function(b,c){if(!b)return!1;if(c===!0){var d=this.settings.core.themes.dir;d||(d=a.jstree.path+"/themes"),c=d+"/"+b+"/style.css"}c&&-1===a.inArray(c,i)&&(a("head").append('<link rel="stylesheet" href="'+c+'" type="text/css" />'),i.push(c)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=b,this.element.addClass("jstree-"+b),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+b+"-responsive"),this.trigger("set_theme",{theme:b})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=a,a&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(b,c){var d,e,f,g;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.set_icon(b[d],c);return!0}return b=this.get_node(b),b&&"#"!==b.id?(g=b.icon,b.icon=c,f=this.get_node(b,!0).children(".jstree-anchor").children(".jstree-themeicon"),c===!1?this.hide_icon(b):c===!0?f.removeClass("jstree-themeicon-custom "+g).css("background","").removeAttr("rel"):-1===c.indexOf("/")&&-1===c.indexOf(".")?(f.removeClass(g).css("background",""),f.addClass(c+" jstree-themeicon-custom").attr("rel",c)):(f.removeClass(g).css("background",""),f.addClass("jstree-themeicon-custom").css("background","url('"+c+"') center center no-repeat").attr("rel",c)),!0):!1},get_icon:function(a){return a=this.get_node(a),a&&"#"!==a.id?a.icon:!1},hide_icon:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.hide_icon(b[c]);return!0}return b=this.get_node(b),b&&"#"!==b?(b.icon=!1,this.get_node(b,!0).children("a").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0):!1},show_icon:function(b){var c,d,e;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.show_icon(b[c]);return!0}return b=this.get_node(b),b&&"#"!==b?(e=this.get_node(b,!0),b.icon=e.length?e.children("a").children(".jstree-themeicon").attr("rel"):!0,b.icon||(b.icon=!0),e.children("a").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0):!1}},a.vakata={},a.vakata.attributes=function(b,c){b=a(b)[0];var d=c?{}:[];return b&&b.attributes&&a.each(b.attributes,function(b,e){-1===a.inArray(e.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==e.nodeValue&&""!==a.trim(e.nodeValue)&&(c?d[e.nodeName]=e.nodeValue:d.push(e.nodeName))}),d},a.vakata.array_unique=function(a){var b,c,d,e=[];for(b=0,d=a.length;d>b;b++){for(c=0;b>=c&&a[b]!==a[c];c++);c===b&&e.push(a[b])}return e},a.vakata.array_remove=function(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=0>b?a.length+b:b,a.push.apply(a,d),a},a.vakata.array_remove_item=function(b,c){var d=a.inArray(c,b);return-1!==d?a.vakata.array_remove(b,d):b},function(){var b={},c=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},d=c(window.navigator.userAgent);d.browser&&(b[d.browser]=!0,b.version=d.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),a.vakata.browser=b}(),a.vakata.browser.msie&&8>a.vakata.browser.version&&(a.jstree.defaults.core.animation=0);var m=document.createElement("I");m.className="jstree-icon jstree-checkbox",a.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0},a.jstree.plugins.checkbox=function(b,c){this.bind=function(){c.bind.call(this),this._data.checkbox.uto=!1,this.element.on("init.jstree",a.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked")},this)).on("loading.jstree",a.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),this.settings.checkbox.three_state&&this.element.on("changed.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",a.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)},this)).on("model.jstree",a.proxy(function(b,c){var d,e,f,g,h,i,j=this._model.data,k=j[c.parent],l=c.nodes,m=[];if(k.state.selected){for(e=0,f=l.length;f>e;e++)j[l[e]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(l)}else for(e=0,f=l.length;f>e;e++)if(j[l[e]].state.selected){for(g=0,h=j[l[e]].children_d.length;h>g;g++)j[j[l[e]].children_d[g]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(j[l[e]].children_d)}for(e=0,f=k.children_d.length;f>e;e++)j[k.children_d[e]].children.length||m.push(j[k.children_d[e]].parent);for(m=a.vakata.array_unique(m),g=0,h=m.length;h>g;g++)for(k=j[m[g]];k&&"#"!==k.id;){for(d=0,e=0,f=k.children.length;f>e;e++)d+=j[k.children[e]].state.selected;if(d!==f)break;k.state.selected=!0,this._data.core.selected.push(k.id),i=this.get_node(k,!0),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-clicked"),k=this.get_node(k.parent)}this._data.core.selected=a.vakata.array_unique(this._data.core.selected)},this)).on("select_node.jstree",a.proxy(function(b,c){var d,e,f,g,h=c.node,i=this._model.data,j=this.get_node(h.parent),k=this.get_node(h,!0);for(this._data.core.selected=a.vakata.array_unique(this._data.core.selected.concat(h.children_d)),d=0,e=h.children_d.length;e>d;d++)g=i[h.children_d[d]],g.state.selected=!0,g&&g.original&&g.original.state&&g.original.state.undetermined&&(g.original.state.undetermined=!1);for(;j&&"#"!==j.id;){for(f=0,d=0,e=j.children.length;e>d;d++)f+=i[j.children[d]].state.selected;if(f!==e)break;j.state.selected=!0,this._data.core.selected.push(j.id),g=this.get_node(j,!0),g&&g.length&&g.children(".jstree-anchor").addClass("jstree-clicked"),j=this.get_node(j.parent)}k.length&&k.find(".jstree-anchor").addClass("jstree-clicked")},this)).on("deselect_all.jstree",a.proxy(function(){var a,b,c,d=this.get_node("#"),e=this._model.data;for(a=0,b=d.children_d.length;b>a;a++)c=e[d.children_d[a]],c&&c.original&&c.original.state&&c.original.state.undetermined&&(c.original.state.undetermined=!1)},this)).on("deselect_node.jstree",a.proxy(function(b,c){var d,e,f,g=c.node,h=this.get_node(g,!0);for(g&&g.original&&g.original.state&&g.original.state.undetermined&&(g.original.state.undetermined=!1),d=0,e=g.children_d.length;e>d;d++)f=this._model.data[g.children_d[d]],f.state.selected=!1,f&&f.original&&f.original.state&&f.original.state.undetermined&&(f.original.state.undetermined=!1);for(d=0,e=g.parents.length;e>d;d++)f=this._model.data[g.parents[d]],f.state.selected=!1,f&&f.original&&f.original.state&&f.original.state.undetermined&&(f.original.state.undetermined=!1),f=this.get_node(g.parents[d],!0),f&&f.length&&f.children(".jstree-anchor").removeClass("jstree-clicked");for(f=[],d=0,e=this._data.core.selected.length;e>d;d++)-1===a.inArray(this._data.core.selected[d],g.children_d)&&-1===a.inArray(this._data.core.selected[d],g.parents)&&f.push(this._data.core.selected[d]);this._data.core.selected=a.vakata.array_unique(f),h.length&&h.find(".jstree-anchor").removeClass("jstree-clicked")},this)).on("delete_node.jstree",a.proxy(function(a,b){for(var c,d,e,f,g=this.get_node(b.parent),h=this._model.data;g&&"#"!==g.id;){for(e=0,c=0,d=g.children.length;d>c;c++)e+=h[g.children[c]].state.selected;if(e!==d)break;g.state.selected=!0,this._data.core.selected.push(g.id),f=this.get_node(g,!0),f&&f.length&&f.children(".jstree-anchor").addClass("jstree-clicked"),g=this.get_node(g.parent)}},this)).on("move_node.jstree",a.proxy(function(b,c){var d,e,f,g,h,i=c.is_multi,j=c.old_parent,k=this.get_node(c.parent),l=this._model.data;if(!i)for(d=this.get_node(j);d&&"#"!==d.id;){for(e=0,f=0,g=d.children.length;g>f;f++)e+=l[d.children[f]].state.selected;if(e!==g)break;d.state.selected=!0,this._data.core.selected.push(d.id),h=this.get_node(d,!0),h&&h.length&&h.children(".jstree-anchor").addClass("jstree-clicked"),d=this.get_node(d.parent)}for(d=k;d&&"#"!==d.id;){for(e=0,f=0,g=d.children.length;g>f;f++)e+=l[d.children[f]].state.selected;if(e===g)d.state.selected||(d.state.selected=!0,this._data.core.selected.push(d.id),h=this.get_node(d,!0),h&&h.length&&h.children(".jstree-anchor").addClass("jstree-clicked"));else{if(!d.state.selected)break;d.state.selected=!1,this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,d.id),h=this.get_node(d,!0),h&&h.length&&h.children(".jstree-anchor").removeClass("jstree-clicked")}d=this.get_node(d.parent)}},this))},this._undetermined=function(){var b,c,d=this._model.data,e=this._data.core.selected,f=[],g=this;for(b=0,c=e.length;c>b;b++)d[e[b]]&&d[e[b]].parents&&(f=f.concat(d[e[b]].parents));for(this.element.find(".jstree-closed").not(":has(ul)").each(function(){var a,e=g.get_node(this);if(e.state.loaded)for(b=0,c=e.children_d.length;c>b;b++)a=d[e.children_d[b]],!a.state.loaded&&a.original&&a.original.state&&a.original.state.undetermined&&a.original.state.undetermined===!0&&(f.push(a.id),f=f.concat(a.parents));else e.original&&e.original.state&&e.original.state.undetermined&&e.original.state.undetermined===!0&&(f.push(e.id),f=f.concat(e.parents))}),f=a.vakata.array_unique(f),f=a.vakata.array_remove_item(f,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),b=0,c=f.length;c>b;b++)d[f[b]].state.selected||(e=this.get_node(f[b],!0),e&&e.length&&e.children("a").children(".jstree-checkbox").addClass("jstree-undetermined"))},this.redraw_node=function(b,d,e){if(b=c.redraw_node.call(this,b,d,e)){var f=b.getElementsByTagName("A")[0];f.insertBefore(m.cloneNode(!1),f.childNodes[0])}return!e&&this.settings.checkbox.three_state&&(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)),b},this.activate_node=function(b,d){return(this.settings.checkbox.whole_node||a(d.target).hasClass("jstree-checkbox"))&&(d.ctrlKey=!0),c.activate_node.call(this,b,d)},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.element.children("ul").removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.element.children("ul").addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()}},a.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.create_node(d,{},"last",function(a){setTimeout(function(){c.edit(a)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.edit(d)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.delete_node(c.is_selected(d)?c.get_selected():d)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.cut(c.is_selected(d)?c.get_selected():d)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.copy(c.is_selected(d)?c.get_selected():d)}},paste:{separator_before:!1,icon:!1,_disabled:function(b){return!a.jstree.reference(b.reference).can_paste()},separator_after:!1,label:"Paste",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);
c.paste(d)}}}}}}},a.jstree.plugins.contextmenu=function(c,d){this.bind=function(){d.bind.call(this);var b=0;this.element.on("contextmenu.jstree",".jstree-anchor",a.proxy(function(a){a.preventDefault(),b=a.ctrlKey?a.timeStamp:0,this.is_loading(a.currentTarget)||this.show_contextmenu(a.currentTarget,a.pageX,a.pageY,a)},this)).on("click.jstree",".jstree-anchor",a.proxy(function(c){this._data.contextmenu.visible&&(!b||c.timeStamp-b>250)&&a.vakata.context.hide()},this)),a(document).on("context_hide.vakata",a.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&a.vakata.context.hide(),d.teardown.call(this)},this.show_contextmenu=function(c,d,e,f){if(c=this.get_node(c),!c||"#"===c.id)return!1;var g=this.settings.contextmenu,h=this.get_node(c,!0),i=h.children(".jstree-anchor"),j=!1,k=!1;(g.show_at_node||d===b||e===b)&&(j=i.offset(),d=j.left,e=j.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(c)&&(this.deselect_all(),this.select_node(c,!1,!1,f)),k=g.items,a.isFunction(k)&&(k=k.call(this,c,a.proxy(function(a){this._show_contextmenu(c,d,e,a)},this))),a.isPlainObject(k)&&this._show_contextmenu(c,d,e,k)},this._show_contextmenu=function(b,c,d,e){var f=this.get_node(b,!0),g=f.children(".jstree-anchor");a(document).one("context_show.vakata",a.proxy(function(b,c){var d="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";a(c.element).addClass(d)},this)),this._data.contextmenu.visible=!0,a.vakata.context.show(g,{x:c,y:d},e),this.trigger("show_contextmenu",{node:b,x:c,y:d})}},function(a){var c=!1,d={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(document).triggerHandler("context_"+b+".vakata",{reference:d.reference,element:d.element,position:{x:d.position_x,y:d.position_y}})},_execute:function(b){return b=d.items[b],b&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:d.reference,element:d.element}))&&b.action?b.action.call(null,{item:b,reference:d.reference,element:d.element,position:{x:d.position_x,y:d.position_y}}):!1},_parse:function(c,e){if(!c)return!1;e||(d.html="",d.items=[]);var f,g="",h=!1;return e&&(g+="<ul>"),a.each(c,function(c,e){return e?(d.items.push(e),!h&&e.separator_before&&(g+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),h=!1,g+="<li class='"+(e._class||"")+(e._disabled===!0||a.isFunction(e._disabled)&&e._disabled({item:e,reference:d.reference,element:d.element})?" vakata-contextmenu-disabled ":"")+"' "+(e.shortcut?" data-shortcut='"+e.shortcut+"' ":"")+">",g+="<a href='#' rel='"+(d.items.length-1)+"'>",a.vakata.context.settings.icons&&(g+="<i ",e.icon&&(g+=-1!==e.icon.indexOf("/")||-1!==e.icon.indexOf(".")?" style='background:url(\""+e.icon+"\") center center no-repeat' ":" class='"+e.icon+"' "),g+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),g+=(a.isFunction(e.label)?e.label({item:c,reference:d.reference,element:d.element}):e.label)+(e.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+e.shortcut+'">'+(e.shortcut_label||"")+"</span>":"")+"</a>",e.submenu&&(f=a.vakata.context._parse(e.submenu,!0),f&&(g+=f)),g+="</li>",e.separator_after&&(g+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",h=!0),b):!0}),g=g.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),e&&(g+="</ul>"),e||(d.html=g,a.vakata.context._trigger("parse")),g.length>10?g:!1},_show_submenu:function(b){if(b=a(b),b.length&&b.children("ul").length){var d=b.children("ul"),e=b.offset().left+b.outerWidth(),f=b.offset().top,g=d.width(),h=d.height(),i=a(window).width()+a(window).scrollLeft(),j=a(window).height()+a(window).scrollTop();c?b[0>e-(g+10+b.outerWidth())?"addClass":"removeClass"]("vakata-context-left"):b[e+g+10>i?"addClass":"removeClass"]("vakata-context-right"),f+h+10>j&&d.css("bottom","-1px"),d.show()}},show:function(b,e,f){var g,h,i,j,k,l,m,n,o=!0;switch(d.element&&d.element.length&&d.element.width(""),o){case!e&&!b:return!1;case!!e&&!!b:d.reference=b,d.position_x=e.x,d.position_y=e.y;break;case!e&&!!b:d.reference=b,g=b.offset(),d.position_x=g.left+b.outerHeight(),d.position_y=g.top;break;case!!e&&!b:d.position_x=e.x,d.position_y=e.y}b&&!f&&a(b).data("vakata_contextmenu")&&(f=a(b).data("vakata_contextmenu")),a.vakata.context._parse(f)&&d.element.html(d.html),d.items.length&&(h=d.element,i=d.position_x,j=d.position_y,k=h.width(),l=h.height(),m=a(window).width()+a(window).scrollLeft(),n=a(window).height()+a(window).scrollTop(),c&&(i-=h.outerWidth(),a(window).scrollLeft()+20>i&&(i=a(window).scrollLeft()+20)),i+k+20>m&&(i=m-(k+20)),j+l+20>n&&(j=n-(l+20)),d.element.css({left:i,top:j}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),d.is_visible=!0,a.vakata.context._trigger("show"))},hide:function(){d.is_visible&&(d.element.hide().find("ul").hide().end().find(":focus").blur(),d.is_visible=!1,a.vakata.context._trigger("hide"))}},a(function(){c="rtl"===a("body").css("direction");var b=!1;d.element=a("<ul class='vakata-context'></ul>"),d.element.on("mouseenter","li",function(c){c.stopImmediatePropagation(),a.contains(this,c.relatedTarget)||(b&&clearTimeout(b),d.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(b){a.contains(this,b.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),a.vakata.context.settings.hide_onmouseleave&&(b=setTimeout(function(){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(a){a.preventDefault()}).on("mouseup","a",function(){a(this).blur().parent().hasClass("vakata-context-disabled")||a.vakata.context._execute(a(this).attr("rel"))===!1||a.vakata.context.hide()}).on("keydown","a",function(b){var c=null;switch(b.which){case 13:case 32:b.type="mouseup",b.preventDefault(),a(b.currentTarget).trigger(b);break;case 37:d.is_visible&&(d.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 38:d.is_visible&&(c=d.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),c.length||(c=d.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),c.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 39:d.is_visible&&(d.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 40:d.is_visible&&(c=d.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),c.length||(c=d.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),c.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on("keydown",function(a){a.preventDefault();var b=d.element.find(".vakata-contextmenu-shortcut-"+a.which).parent();b.parent().not(".vakata-context-disabled")&&b.mouseup()}).appendTo("body"),a(document).on("mousedown",function(b){d.is_visible&&!a.contains(d.element[0],b.target)&&a.vakata.context.hide()}).on("context_show.vakata",function(){d.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),c&&d.element.addClass("vakata-context-rtl").css("direction","rtl"),d.element.find("ul").hide().end()})})}(a),a.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1},a.jstree.plugins.dnd=function(c,d){this.bind=function(){d.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",a.proxy(function(c){var d=this.get_node(c.target),e=this.is_selected(d)?this.get_selected().length:1;return d&&d.id&&"#"!==d.id&&(1===c.which||"touchstart"===c.type)&&(this.settings.dnd.is_draggable===!0||a.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,e>1?this.get_selected(!0):[d]))?(this.element.trigger("mousedown.jstree"),a.vakata.dnd.start(c,{jstree:!0,origin:this,obj:this.get_node(d,!0),nodes:e>1?this.get_selected():[d.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+'"><i class="jstree-icon jstree-er"></i>'+(e>1?e+" "+this.get_string("nodes"):this.get_text(c.currentTarget,!0))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')):b},this))}},a(function(){var c=!1,d=!1,e=!1,f=a('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");a(document).bind("dnd_start.vakata",function(){c=!1}).bind("dnd_move.vakata",function(g,h){if(e&&clearTimeout(e),h.data.jstree&&(!h.event.target.id||"jstree-marker"!==h.event.target.id)){var i,j,k,l,m,n,o,p,q,r,s,t,u=a.jstree.reference(h.event.target),v=!1,w=!1,x=!1;if(u&&u._data&&u._data.dnd)if(f.attr("class","jstree-"+u.get_theme()),h.helper.children().attr("class","jstree-"+u.get_theme()).find(".jstree-copy:eq(0)")[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey))?"show":"hide"](),h.event.target!==u.element[0]&&h.event.target!==u.get_container_ul()[0]||0!==u.get_container_ul().children().length){if(v=a(h.event.target).closest("a"),v&&v.length&&v.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(w=v.offset(),x=h.event.pageY-w.top,k=v.height(),n=k/3>x?["b","i","a"]:x>k-k/3?["a","i","b"]:x>k/2?["i","a","b"]:["i","b","a"],a.each(n,function(g,x){switch(x){case"b":i=w.left-6,j=w.top-5,l=u.get_parent(v),m=v.parent().index();break;case"i":i=w.left-2,j=w.top-5+k/2+1,l=u.get_node(v.parent()).id,m=0;break;case"a":i=w.left-6,j=w.top-5+k,l=u.get_parent(v),m=v.parent().index()+1}for(o=!0,p=0,q=h.data.nodes.length;q>p;p++)if(r=h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey))?"copy_node":"move_node",s=m,"move_node"===r&&"a"===x&&h.data.origin&&h.data.origin===u&&l===u.get_parent(h.data.nodes[p])&&(t=u.get_node(l),s>a.inArray(h.data.nodes[p],t.children)&&(s-=1)),o=o&&(u&&u.settings&&u.settings.dnd&&u.settings.dnd.check_while_dragging===!1||u.check(r,h.data.origin&&h.data.origin!==u?h.data.origin.get_node(h.data.nodes[p]):h.data.nodes[p],l,s,{dnd:!0,ref:u.get_node(v.parent()),pos:x,is_multi:h.data.origin&&h.data.origin!==u,is_foreign:!h.data.origin})),!o){u&&u.last_error&&(d=u.last_error());break}return o?("i"===x&&v.parent().is(".jstree-closed")&&u.settings.dnd.open_timeout&&(e=setTimeout(function(a,b){return function(){a.open_node(b)}}(u,v),u.settings.dnd.open_timeout)),c={ins:u,par:l,pos:m},f.css({left:i+"px",top:j+"px"}).show(),h.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),d={},n=!0,!1):b}),n===!0))return}else{for(o=!0,p=0,q=h.data.nodes.length;q>p&&(o=o&&u.check(h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey))?"copy_node":"move_node",h.data.origin&&h.data.origin!==u?h.data.origin.get_node(h.data.nodes[p]):h.data.nodes[p],"#","last",{dnd:!0,ref:u.get_node("#"),pos:"i",is_multi:h.data.origin&&h.data.origin!==u,is_foreign:!h.data.origin}),o);p++);if(o)return c={ins:u,par:"#",pos:"last"},f.hide(),h.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),b}c=!1,h.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),f.hide()}}).bind("dnd_scroll.vakata",function(a,b){b.data.jstree&&(f.hide(),c=!1,b.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er"))}).bind("dnd_stop.vakata",function(b,g){if(e&&clearTimeout(e),g.data.jstree){f.hide();var h,i,j=[];if(c){for(h=0,i=g.data.nodes.length;i>h;h++)j[h]=g.data.origin?g.data.origin.get_node(g.data.nodes[h]):g.data.nodes[h],g.data.origin&&(j[h].instance=g.data.origin);c.ins[g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node"](j,c.par,c.pos)}else h=a(g.event.target).closest(".jstree"),h.length&&d&&d.error&&"check"===d.error&&(h=h.jstree(!0),h&&h.settings.core.error.call(this,d))}}).bind("keyup keydown",function(b,c){c=a.vakata.dnd._get(),c.data&&c.data.jstree&&c.helper.find(".jstree-copy:eq(0)")[c.data.origin&&(c.data.origin.settings.dnd.always_copy||c.data.origin.settings.dnd.copy&&(b.metaKey||b.ctrlKey))?"show":"hide"]()})}),function(a){var c={element:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1};a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5},_trigger:function(b,c){var d=a.vakata.dnd._get();d.event=c,a(document).triggerHandler("dnd_"+b+".vakata",d)},_get:function(){return{data:c.data,element:c.element,helper:c.helper}},_clean:function(){c.helper&&c.helper.remove(),c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),c={element:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1},a(document).off("mousemove touchmove",a.vakata.dnd.drag),a(document).off("mouseup touchend",a.vakata.dnd.stop)},_scroll:function(b){if(!c.scroll_e||!c.scroll_l&&!c.scroll_t)return c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),!1;if(!c.scroll_i)return c.scroll_i=setInterval(a.vakata.dnd._scroll,100),!1;if(b===!0)return!1;var d=c.scroll_e.scrollTop(),e=c.scroll_e.scrollLeft();c.scroll_e.scrollTop(d+c.scroll_t*a.vakata.dnd.settings.scroll_speed),c.scroll_e.scrollLeft(e+c.scroll_l*a.vakata.dnd.settings.scroll_speed),(d!==c.scroll_e.scrollTop()||e!==c.scroll_e.scrollLeft())&&a.vakata.dnd._trigger("scroll",c.scroll_e)},start:function(b,d,e){"touchstart"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag&&a.vakata.dnd.stop({});try{b.currentTarget.unselectable="on",b.currentTarget.onselectstart=function(){return!1},b.currentTarget.style&&(b.currentTarget.style.MozUserSelect="none")}catch(f){}return c.init_x=b.pageX,c.init_y=b.pageY,c.data=d,c.is_down=!0,c.element=b.currentTarget,e!==!1&&(c.helper=a("<div id='vakata-dnd'></div>").html(e).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),a(document).bind("mousemove touchmove",a.vakata.dnd.drag),a(document).bind("mouseup touchend",a.vakata.dnd.stop),!1},drag:function(d){if("touchmove"===d.type&&d.originalEvent&&d.originalEvent.changedTouches&&d.originalEvent.changedTouches[0]&&(d.pageX=d.originalEvent.changedTouches[0].pageX,d.pageY=d.originalEvent.changedTouches[0].pageY,d.target=document.elementFromPoint(d.originalEvent.changedTouches[0].pageX-window.pageXOffset,d.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_down){if(!c.is_drag){if(!(Math.abs(d.pageX-c.init_x)>a.vakata.dnd.settings.threshold||Math.abs(d.pageY-c.init_y)>a.vakata.dnd.settings.threshold))return;c.helper&&(c.helper.appendTo("body"),c.helper_w=c.helper.outerWidth()),c.is_drag=!0,a.vakata.dnd._trigger("start",d)}var e=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!1,l=!1,m=!1,n=!1;c.scroll_t=0,c.scroll_l=0,c.scroll_e=!1,a(a(d.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var e=a(this),f=e.offset();return this.scrollHeight>this.offsetHeight&&(f.top+e.height()-d.pageY<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),d.pageY-f.top<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(f.left+e.width()-d.pageX<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),d.pageX-f.left<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1)),c.scroll_t||c.scroll_l?(c.scroll_e=a(this),!1):b}),c.scroll_e||(e=a(document),f=a(window),g=e.height(),h=f.height(),i=e.width(),j=f.width(),k=e.scrollTop(),l=e.scrollLeft(),g>h&&d.pageY-k<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1),g>h&&h-(d.pageY-k)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),i>j&&d.pageX-l<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1),i>j&&j-(d.pageX-l)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),(c.scroll_t||c.scroll_l)&&(c.scroll_e=e)),c.scroll_e&&a.vakata.dnd._scroll(!0),c.helper&&(m=parseInt(d.pageY+a.vakata.dnd.settings.helper_top,10),n=parseInt(d.pageX+a.vakata.dnd.settings.helper_left,10),g&&m+25>g&&(m=g-50),i&&n+c.helper_w>i&&(n=i-(c.helper_w+2)),c.helper.css({left:n+"px",top:m+"px"})),a.vakata.dnd._trigger("move",d)}},stop:function(b){"touchend"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag&&a.vakata.dnd._trigger("stop",b),a.vakata.dnd._clean()}}}(jQuery),a.jstree.defaults.search={ajax:!1,fuzzy:!0,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1},a.jstree.plugins.search=function(b,c){this.bind=function(){c.bind.call(this),this._data.search.str="",this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this.element.on("before_open.jstree",a.proxy(function(){var b,c,d,e=this._data.search.res,f=[],g=a();if(e&&e.length){for(this._data.search.dom=a(),b=0,c=e.length;c>b;b++)f=f.concat(this.get_node(e[b]).parents),d=this.get_node(e[b],!0),d&&(this._data.search.dom=this._data.search.dom.add(d));for(f=a.vakata.array_unique(f),b=0,c=f.length;c>b;b++)"#"!==f[b]&&(d=this.get_node(f[b],!0),d&&(g=g.add(d)));this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this.settings.search.show_only_matches&&this._data.search.res.length&&(this.element.find("li").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),g=g.add(this._data.search.dom),g.parentsUntil(".jstree").addBack().show().filter("ul").each(function(){a(this).children("li:visible").eq(-1).addClass("jstree-last")}))}},this)),this.settings.search.show_only_matches&&this.element.on("search.jstree",function(b,c){c.nodes.length&&(a(this).find("li").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),c.nodes.parentsUntil(".jstree").addBack().show().filter("ul").each(function(){a(this).children("li:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",function(b,c){c.nodes.length&&a(this).find("li").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})},this.search=function(b,c){if(b===!1||""===a.trim(b))return this.clear_search();var d,e,f=this.settings.search,g=f.ajax?f.ajax:!1,h=null,i=[],j=[];if(this._data.search.res.length&&this.clear_search(),!c&&g!==!1)return a.isFunction(g)?g.call(this,b,a.proxy(function(c){c&&c.d&&(c=c.d),this._load_nodes(a.isArray(c)?c:[],function(){this.search(b,!0)})},this)):(g=a.extend({},g),g.data||(g.data={}),g.data.str=b,a.ajax(g).fail(a.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(g)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(a.proxy(function(c){c&&c.d&&(c=c.d),this._load_nodes(a.isArray(c)?c:[],function(){this.search(b,!0)})},this)));if(this._data.search.str=b,this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],h=new a.vakata.search(b,!0,{caseSensitive:f.case_sensitive,fuzzy:f.fuzzy}),a.each(this._model.data,function(a,b){b.text&&h.search(b.text).isMatch&&(!f.search_leaves_only||b.state.loaded&&0===b.children.length)&&(i.push(a),j=j.concat(b.parents))}),i.length){for(j=a.vakata.array_unique(j),this._search_open(j),d=0,e=i.length;e>d;d++)h=this.get_node(i[d],!0),h&&(this._data.search.dom=this._data.search.dom.add(h));this._data.search.res=i,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:b,res:this._data.search.res})},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=a()},this._search_open=function(b){var c=this;a.each(b.concat([]),function(d,e){if("#"===e)return!0;try{e=a("#"+e.replace(a.jstree.idregex,"\\$&"),c.element)}catch(f){}e&&e.length&&c.is_closed(e)&&(c._data.search.opn.push(e[0].id),c.open_node(e,function(){c._search_open(b)},0))})}},function(a){a.vakata.search=function(a,b,c){c=c||{},c.fuzzy!==!1&&(c.fuzzy=!0),a=c.caseSensitive?a:a.toLowerCase();var d,e,f,g,h=c.location||0,i=c.distance||100,j=c.threshold||.6,k=a.length;return k>32&&(c.fuzzy=!1),c.fuzzy&&(d=1<<k-1,e=function(){var b={},c=0;for(c=0;k>c;c++)b[a.charAt(c)]=0;for(c=0;k>c;c++)b[a.charAt(c)]|=1<<k-c-1;return b}(),f=function(a,b){var c=a/k,d=Math.abs(h-b);return i?c+d/i:d?1:c}),g=function(b){if(b=c.caseSensitive?b:b.toLowerCase(),a===b||-1!==b.indexOf(a))return{isMatch:!0,score:0};if(!c.fuzzy)return{isMatch:!1,score:1};var g,i,l,m,n,o,p,q,r,s=b.length,t=j,u=b.indexOf(a,h),v=k+s,w=1,x=[];for(-1!==u&&(t=Math.min(f(0,u),t),u=b.lastIndexOf(a,h+k),-1!==u&&(t=Math.min(f(0,u),t))),u=-1,g=0;k>g;g++){for(l=0,m=v;m>l;)t>=f(g,h+m)?l=m:v=m,m=Math.floor((v-l)/2+l);for(v=m,o=Math.max(1,h-m+1),p=Math.min(h+m,s)+k,q=Array(p+2),q[p+1]=(1<<g)-1,i=p;i>=o;i--)if(r=e[b.charAt(i-1)],q[i]=0===g?(1|q[i+1]<<1)&r:(1|q[i+1]<<1)&r|(1|(n[i+1]|n[i])<<1)|n[i+1],q[i]&d&&(w=f(g,i-1),t>=w)){if(t=w,u=i-1,x.push(u),!(u>h))break;o=Math.max(1,2*h-u)}if(f(g+1,h)>t)break;n=q}return{isMatch:u>=0,score:w}},b===!0?{search:g}:g(b)}}(jQuery),a.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1},a.jstree.plugins.sort=function(b,c){this.bind=function(){c.bind.call(this),this.element.on("model.jstree",a.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",a.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1),this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",a.proxy(function(a,b){this.sort(b.parent,!1),this.redraw_node(b.parent,!0)},this))},this.sort=function(b,c){var d,e;if(b=this.get_node(b),b&&b.children&&b.children.length&&(b.children.sort(a.proxy(this.settings.sort,this)),c))for(d=0,e=b.children_d.length;e>d;d++)this.sort(b.children_d[d],!1)}};var n=!1;a.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1},a.jstree.plugins.state=function(b,c){this.bind=function(){c.bind.call(this);var b=a.proxy(function(){this.element.on(this.settings.state.events,a.proxy(function(){n&&clearTimeout(n),n=setTimeout(a.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",a.proxy(function(){this.element.one("restore_state.jstree",b),this.restore_state()||b()},this))},this.save_state=function(){var b={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};a.vakata.storage.set(this.settings.state.key,JSON.stringify(b))},this.restore_state=function(){var b=a.vakata.storage.get(this.settings.state.key);if(b)try{b=JSON.parse(b)}catch(c){return!1}return b&&b.ttl&&b.sec&&+new Date-b.sec>b.ttl?!1:(b&&b.state&&(b=b.state),b&&a.isFunction(this.settings.state.filter)&&(b=this.settings.state.filter.call(this,b)),b?(this.element.one("set_state.jstree",function(c,d){d.instance.trigger("restore_state",{state:a.extend(!0,{},b)})}),this.set_state(b),!0):!1)},this.clear_state=function(){return a.vakata.storage.del(this.settings.state.key)}},function(a){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}}(jQuery),a.jstree.defaults.types={"#":{},"default":{}},a.jstree.plugins.types=function(c,d){this.init=function(a,c){var e,f;if(c&&c.types&&c.types["default"])for(e in c.types)if("default"!==e&&"#"!==e&&c.types.hasOwnProperty(e))for(f in c.types["default"])c.types["default"].hasOwnProperty(f)&&c.types[e][f]===b&&(c.types[e][f]=c.types["default"][f]);d.init.call(this,a,c),this._model.data["#"].type="#"},this.refresh=function(a){d.refresh.call(this,a),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",a.proxy(function(a,c){var d,e,f=this._model.data,g=c.nodes,h=this.settings.types,i="default";for(d=0,e=g.length;e>d;d++)i="default",f[g[d]].original&&f[g[d]].original.type&&h[f[g[d]].original.type]&&(i=f[g[d]].original.type),f[g[d]].data&&f[g[d]].data.jstree&&f[g[d]].data.jstree.type&&h[f[g[d]].data.jstree.type]&&(i=f[g[d]].data.jstree.type),f[g[d]].type=i,f[g[d]].icon===!0&&h[i].icon!==b&&(f[g[d]].icon=h[i].icon)},this)),d.bind.call(this)},this.get_json=function(b,c,e){var f,g,h=this._model.data,i=c?a.extend(!0,{},c,{no_id:!1}):{},j=d.get_json.call(this,b,i,e);if(j===!1)return!1;if(a.isArray(j))for(f=0,g=j.length;g>f;f++)j[f].type=j[f].id&&h[j[f].id]&&h[j[f].id].type?h[j[f].id].type:"default",c&&c.no_id&&(delete j[f].id,j[f].li_attr&&j[f].li_attr.id&&delete j[f].li_attr.id);else j.type=j.id&&h[j.id]&&h[j.id].type?h[j.id].type:"default",c&&c.no_id&&(j=this._delete_ids(j));return j},this._delete_ids=function(b){if(a.isArray(b)){for(var c=0,d=b.length;d>c;c++)b[c]=this._delete_ids(b[c]);return b}return delete b.id,b.li_attr&&b.li_attr.id&&delete b.li_attr.id,b.children&&a.isArray(b.children)&&(b.children=this._delete_ids(b.children)),b},this.check=function(c,e,f,g,h){if(d.check.call(this,c,e,f,g,h)===!1)return!1;e=e&&e.id?e:this.get_node(e),f=f&&f.id?f:this.get_node(f);var i,j,k,l,m=e&&e.id?a.jstree.reference(e.id):null;switch(m=m&&m._model&&m._model.data?m._model.data:null,c){case"create_node":case"move_node":case"copy_node":if("move_node"!==c||-1===a.inArray(e.id,f.children)){if(i=this.get_rules(f),i.max_children!==b&&-1!==i.max_children&&i.max_children===f.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(i.valid_children!==b&&-1!==i.valid_children&&-1===a.inArray(e.type,i.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(m&&e.children_d&&e.parents){for(j=0,k=0,l=e.children_d.length;l>k;k++)j=Math.max(j,m[e.children_d[k]].parents.length);j=j-e.parents.length+1}(0>=j||j===b)&&(j=1);do{if(i.max_depth!==b&&-1!==i.max_depth&&j>i.max_depth)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent),i=this.get_rules(f),j++}while(f)}}return!0},this.get_rules=function(a){if(a=this.get_node(a),!a)return!1;var c=this.get_type(a,!0);return c.max_depth===b&&(c.max_depth=-1),c.max_children===b&&(c.max_children=-1),c.valid_children===b&&(c.valid_children=-1),c},this.get_type=function(b,c){return b=this.get_node(b),b?c?a.extend({type:b.type},this.settings.types[b.type]):b.type:!1},this.set_type=function(c,d){var e,f,g,h,i;if(a.isArray(c)){for(c=c.slice(),f=0,g=c.length;g>f;f++)this.set_type(c[f],d);return!0}return e=this.settings.types,c=this.get_node(c),e[d]&&c?(h=c.type,i=this.get_icon(c),c.type=d,(i===!0||e[h]&&e[h].icon&&i===e[h].icon)&&this.set_icon(c,e[d].icon!==b?e[d].icon:!0),!0):!1}},a.jstree.plugins.unique=function(b,c){this.check=function(b,d,e,f,g){if(c.check.call(this,b,d,e,f,g)===!1)return!1;if(d=d&&d.id?d:this.get_node(d),e=e&&e.id?e:this.get_node(e),!e||!e.children)return!0;var h,i,j="rename_node"===b?f:d.text,k=[],l=this._model.data;for(h=0,i=e.children.length;i>h;h++)k.push(l[e.children[h]].text);switch(b){case"delete_node":return!0;case"rename_node":case"copy_node":return h=-1===a.inArray(j,k),h||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+j+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:d&&d.id?d.id:!1,par:e&&e.id?e.id:!1})}),h;case"move_node":return h=d.parent===e.id||-1===a.inArray(j,k),h||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+j+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:d&&d.id?d.id:!1,par:e&&e.id?e.id:!1})}),h}return!0}};var o=document.createElement("DIV");o.setAttribute("unselectable","on"),o.className="jstree-wholerow",o.innerHTML="&#160;",a.jstree.plugins.wholerow=function(b,c){this.bind=function(){c.bind.call(this),this.element.on("loading",a.proxy(function(){o.style.height=this._data.core.li_height+"px"},this)).on("ready.jstree set_state.jstree",a.proxy(function(){this.hide_dots()},this)).on("ready.jstree",a.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",a.proxy(function(){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",a.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var c,d,e=!1;for(c=0,d=b.selected.length;d>c;c++)e=this.get_node(b.selected[c],!0),e&&e.length&&e.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",a.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",a.proxy(function(a,b){this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",a.proxy(function(b){b.preventDefault();var c=a.Event("contextmenu",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey,pageX:b.pageX,pageY:b.pageY});a(b.currentTarget).closest("li").children("a:eq(0)").trigger(c)},this)).on("click.jstree",".jstree-wholerow",function(b){b.stopImmediatePropagation();var c=a.Event("click",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest("li").children("a:eq(0)").trigger(c).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",a.proxy(function(b){b.stopImmediatePropagation();var c=a.Event("click",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});
a(b.currentTarget).closest("li").children("a:eq(0)").trigger(c).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",a.proxy(function(a){return a.stopImmediatePropagation(),this.hover_node(a.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",a.proxy(function(a){this.dehover_node(a.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),c.teardown.call(this)},this.redraw_node=function(b,d,e){if(b=c.redraw_node.call(this,b,d,e)){var f=o.cloneNode(!0);-1!==a.inArray(b.id,this._data.core.selected)&&(f.className+=" jstree-wholerow-clicked"),b.insertBefore(f,b.childNodes[0])}return b}}}}),function(a){function b(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function c(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}function d(a){for(t in v)v[t]=a[B[t]]}function e(a){var c,e,f,g,i,j;if(c=a.keyCode,-1==b(A,c)&&A.push(c),(93==c||224==c)&&(c=91),c in v){v[c]=!0;for(f in x)x[f]==c&&(h[f]=!0)}else if(d(a),h.filter.call(this,a)&&c in u)for(j=n(),g=0;g<u[c].length;g++)if(e=u[c][g],e.scope==j||"all"==e.scope){i=e.mods.length>0;for(f in v)(!v[f]&&b(e.mods,+f)>-1||v[f]&&-1==b(e.mods,+f))&&(i=!1);(0!=e.mods.length||v[16]||v[18]||v[17]||v[91])&&!i||e.method(a,e)===!1&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}function f(a){var c,d=a.keyCode,e=b(A,d);if(e>=0&&A.splice(e,1),(93==d||224==d)&&(d=91),d in v){v[d]=!1;for(c in x)x[c]==d&&(h[c]=!1)}}function g(){for(t in v)v[t]=!1;for(t in x)h[t]=!1}function h(a,b,c){var d,e;d=p(a),void 0===c&&(c=b,b="all");for(var f=0;f<d.length;f++)e=[],a=d[f].split("+"),a.length>1&&(e=q(a),a=[a[a.length-1]]),a=a[0],a=z(a),a in u||(u[a]=[]),u[a].push({shortcut:d[f],scope:b,method:c,key:d[f],mods:e})}function i(a,b){var d,e,f,g,h,i=[];for(d=p(a),g=0;g<d.length;g++){if(e=d[g].split("+"),e.length>1&&(i=q(e),a=e[e.length-1]),a=z(a),void 0===b&&(b=n()),!u[a])return;for(f=0;f<u[a].length;f++)h=u[a][f],h.scope===b&&c(h.mods,i)&&(u[a][f]={})}}function j(a){return"string"==typeof a&&(a=z(a)),-1!=b(A,a)}function k(){return A.slice(0)}function l(a){var b=(a.target||a.srcElement).tagName;return!("INPUT"==b||"SELECT"==b||"TEXTAREA"==b)}function m(a){w=a||"all"}function n(){return w||"all"}function o(a){var b,c,d;for(b in u)for(c=u[b],d=0;d<c.length;)c[d].scope===a?c.splice(d,1):d++}function p(a){var b;return a=a.replace(/\s/g,""),b=a.split(","),""==b[b.length-1]&&(b[b.length-2]+=","),b}function q(a){for(var b=a.slice(0,a.length-1),c=0;c<b.length;c++)b[c]=x[b[c]];return b}function r(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}function s(){var b=a.key;return a.key=C,b}var t,u={},v={16:!1,18:!1,17:!1,91:!1},w="all",x={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,command:91},y={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},z=function(a){return y[a]||a.toUpperCase().charCodeAt(0)},A=[];for(t=1;20>t;t++)y["f"+t]=111+t;var B={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(t in x)h[t]=!1;r(document,"keydown",function(a){e(a)}),r(document,"keyup",f),r(window,"focus",g);var C=a.key;a.key=h,a.key.setScope=m,a.key.getScope=n,a.key.deleteScope=o,a.key.filter=l,a.key.isPressed=j,a.key.getPressedKeyCodes=k,a.key.noConflict=s,a.key.unbind=i,"undefined"!=typeof module&&(module.exports=key)}(this),Resurrect.GLOBAL=(0,eval)("this"),Resurrect.escapeRegExp=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},Resurrect.prototype.Error=function(a){this.message=a||"",this.stack=(new Error).stack},Resurrect.prototype.Error.prototype=Object.create(Error.prototype),Resurrect.prototype.Error.prototype.name="ResurrectError",Resurrect.NamespaceResolver=function(a){this.scope=a},Resurrect.NamespaceResolver.prototype.getPrototype=function(a){var b=this.scope[a];if(b)return b.prototype;throw new Resurrect.prototype.Error("Unknown constructor: "+a)},Resurrect.NamespaceResolver.prototype.getName=function(a){var b=a.constructor.name;if(null==b){var c=/^\s*function\s*([A-Za-z0-9_$]*)/;b=c.exec(a.constructor)[1]}if(""===b){var d="Can't serialize objects with anonymous constructors.";throw new Resurrect.prototype.Error(d)}return"Object"===b||"Array"===b?null:b},Resurrect.prototype.resolver=new Resurrect.NamespaceResolver(Resurrect.GLOBAL),Resurrect.Node=function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild},Resurrect.is=function(a){var b="[object "+a+"]";return function(a){return Object.prototype.toString.call(a)===b}},Resurrect.isArray=Resurrect.is("Array"),Resurrect.isString=Resurrect.is("String"),Resurrect.isBoolean=Resurrect.is("Boolean"),Resurrect.isNumber=Resurrect.is("Number"),Resurrect.isFunction=Resurrect.is("Function"),Resurrect.isDate=Resurrect.is("Date"),Resurrect.isRegExp=Resurrect.is("RegExp"),Resurrect.isObject=Resurrect.is("Object"),Resurrect.isAtom=function(a){return!Resurrect.isObject(a)&&!Resurrect.isArray(a)},Resurrect.isPrimitive=function(a){return null==a||Resurrect.isNumber(a)||Resurrect.isString(a)||Resurrect.isBoolean(a)},Resurrect.prototype.ref=function(a){var b={};return b[this.prefix]=void 0===a?-1:a[this.refcode],b},Resurrect.prototype.deref=function(a){return this.table[a[this.prefix]]},Resurrect.prototype.tag=function(a){if(this.revive){var b=this.resolver.getName(a);if(b){var c=Object.getPrototypeOf(a);if(this.resolver.getPrototype(b)!==c)throw new this.Error("Constructor mismatch!");a[this.prefix]=b}}return a[this.refcode]=this.table.length,this.table.push(a),a[this.refcode]},Resurrect.prototype.builder=function(a,b){var c={};return c[this.buildcode]=a,c[this.valuecode]=b,c},Resurrect.prototype.build=function(a){var b=a[this.buildcode].split(/\./).reduce(function(a,b){return a[b]},Resurrect.GLOBAL),c=[null].concat(a[this.valuecode]),d=b.bind.apply(b,c),e=new d;return Resurrect.isPrimitive(e)?e.valueOf():e},Resurrect.prototype.decode=function(a){if(this.prefix in a)return this.deref(a);if(this.buildcode in a)return this.build(a);throw new this.Error("Unknown encoding.")},Resurrect.prototype.isTagged=function(a){return this.refcode in a&&null!=a[this.refcode]},Resurrect.prototype.visit=function(a,b){if(Resurrect.isAtom(a))return b(a);if(this.isTagged(a))return this.ref(a);var c=null;if(Resurrect.isArray(a)){c=[],a[this.refcode]=this.tag(c);for(var d=0;d<a.length;d++)c.push(this.visit(a[d],b))}else{c=Object.create(Object.getPrototypeOf(a)),a[this.refcode]=this.tag(c);for(var e in a)a.hasOwnProperty(e)&&(c[e]=this.visit(a[e],b))}return c[this.origcode]=a,this.ref(c)},Resurrect.prototype.handleAtom=function(a){var b=Resurrect.GLOBAL.Node||function(){};if(Resurrect.isFunction(a))throw new this.Error("Can't serialize functions.");if(a instanceof b){var c=new XMLSerializer;return this.builder("Resurrect.Node",[c.serializeToString(a)])}if(Resurrect.isDate(a))return this.builder("Date",[a.toISOString()]);if(Resurrect.isRegExp(a)){var d=a.toString().match(/\/(.+)\/([gimy]*)/).slice(1);return this.builder("RegExp",d)}return void 0===a?this.ref(void 0):!Resurrect.isNumber(a)||!isNaN(a)&&isFinite(a)?a:this.builder("Number",[a.toString()])},Resurrect.prototype.replacerWrapper=function(a){var b=new RegExp("^"+Resurrect.escapeRegExp(this.prefix));return function(c,d){return b.test(c)?d:a(c,d)}},Resurrect.prototype.stringify=function(a,b,c){if(Resurrect.isFunction(b))b=this.replacerWrapper(b);else if(Resurrect.isArray(b)){var d=[this.prefix,this.refcode,this.origcode,this.buildcode,this.valuecode];b=d.concat(b)}if(Resurrect.isAtom(a))return JSON.stringify(this.handleAtom(a),b,c);this.table=[],this.visit(a,this.handleAtom.bind(this));for(var e=0;e<this.table.length;e++)this.cleanup?delete this.table[e][this.origcode][this.refcode]:this.table[e][this.origcode][this.refcode]=null,delete this.table[e][this.refcode],delete this.table[e][this.origcode];var f=this.table;return this.table=null,JSON.stringify(f,b,c)},Resurrect.prototype.fixPrototype=function(a){if(this.prefix in a){var b=a[this.prefix],c=this.resolver.getPrototype(b);if("__proto__"in a)return a.__proto__=c,this.cleanup&&delete a[this.prefix],a;var d=Object.create(c);for(var e in a)a.hasOwnProperty(e)&&e!==this.prefix&&(d[e]=a[e]);return d}return a},Resurrect.prototype.resurrect=function(a){var b=null,c=JSON.parse(a);if(Resurrect.isArray(c)){if(this.table=c,this.revive)for(var d=0;d<this.table.length;d++)this.table[d]=this.fixPrototype(this.table[d]);for(d=0;d<this.table.length;d++){var e=this.table[d];for(var f in e)e.hasOwnProperty(f)&&(Resurrect.isAtom(e[f])||(e[f]=this.decode(e[f])))}b=this.table[0]}else Resurrect.isObject(c)?(this.table=[],b=this.decode(c)):b=c;return this.table=null,b};